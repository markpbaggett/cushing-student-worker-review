"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5045],{95449:(e,t,i)=>{i.r(t),i.d(t,{default:()=>aD});var n,r,a,o=i(3748),l=i(11806),s=i(57906),c=i(14232),d=i(79106),u=i(97559),m=i(57186),p=i(3135),h=i(18433),f=i(29287),g=i(72511),v=i(46008),y=i(67661),b=i(73046),x=i(10204),w=i(23686),E=i(67376),S=i(50664),C=i(11600),A=i(73139),k=i(25376),I=i(10887),R=i(29938);let T="clover",O=Object.fromEntries(Object.entries({en:{commonClose:"Close",commonNext:"Next",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},pt:{}}).map(([e,t])=>[e,{[`${T}`]:t}]));l.Ay.use(o.A).use(s.r9).init({defaultNS:T,fallbackLng:"en",ns:[T],resources:{...O}});var $=function(e){return function(){let t={type:e,getType:()=>e,toString:()=>e};return(e,i)=>({...t,...void 0!==e&&{payload:e},...void 0!==i&&{meta:i}})}},L="@iiif/IMPORT_ENTITIES",M="@iiif/MODIFY_ENTITY_FIELD",P="@iiif/REORDER_ENTITY_FIELD",F="@iiif/ADD_REFERENCE",j="@iiif/UPDATE_REFERENCE",z="@iiif/REMOVE_REFERENCE",_="@iiif/ADD_METADATA",H="@iiif/REMOVE_METADATA",B="@iiif/UPDATE_METADATA",D="@iiif/REORDER_METADATA",V=$(L)(),N=$(M)(),W=($(P)(),$(F)(),$(z)(),$(j)(),$(_)(),$(B)(),$(H)(),$(D)(),{modifyEntityField:N}),q="@iiif/ADD_MAPPING",U="@iiif/ADD_MAPPINGS",Q=$(q)(),G=$(U)(),J="RESOURCE_ERROR",Z="RESOURCE_LOADING",X="RESOURCE_READY",Y="@iiif/REQUEST_RESOURCE",K="@iiif/REQUEST_ERROR",ee="@iiif/REQUEST_MISMATCH",et="@iiif/REQUEST_COMPLETE",ei=$(Y)(),en=$(K)(),er=$(ee)(),ea=$(et)(),eo="@iiif/BATCH",el=$(eo)(),es=(e,t)=>{let{entities:i,resource:n,mapping:r}=(0,d.z)(t);if(void 0===n.id)return[en({id:e,message:"ID is not defined in resource."})];let a=[V({entities:i}),G({mapping:r})];return n.id!==e&&(a.push(Q({id:e,type:n.type})),a.push(er({requestId:e,actualId:n.id}))),a.push(ea({id:e})),a},ec=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function ed(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){var i,n;if(!((i=e[r])===(n=t[r])||ec(i)&&ec(n)))return!1}return!0}function eu(e,t,i){let n=e.iiif.requests[t],r=e.iiif.mapping[t];if(!r||!e.iiif.entities[r][n.resourceUri])return;let a=e.iiif.entities[r][n.resourceUri];if(a&&a[d.c]){let e=a[d.c].find(e=>e[d.d]===a.id);return(0,d.j)(a,e)}return a}function em(e,t,{waitTimeout:i=30}={}){return(n,r,a)=>{let o=e.getStore(),l=o.getState(),s=l.iiif.requests[n];if(s){if(s.loadingState===X){let e=eu(l,n);if(e)return e}switch(s.loadingState){case J:break;case Z:return(async()=>{let e,t=!1;try{let r=await Promise.race([new Promise((i,r)=>{t||(e=o.subscribe(()=>{let e=o.getState();if(e.iiif.requests[n].loadingState===J)return void r();if(e.iiif.requests[n].loadingState===X){let t=eu(e,n);t?i(t):r()}}))}),new Promise((e,n)=>setTimeout(()=>{t=!0,n()},60*i*1e3))]);if(e&&e(),r)return r}catch{e&&e()}})()}}e.dispatch(ei({id:n}));let c=t=>{if(!t)return;t.id||t["@id"]||(t["@type"]&&(t["@id"]=n),t.id=n);let i=es(n,t);return e.dispatch(el({actions:i})),eu(o.getState(),n)};try{let i=t(n,r);return i&&"function"==typeof i.then?(async()=>{try{let e=await i;return a&&(e=a(e)),c(e)}catch(t){throw e.dispatch(en({id:n,message:t.toString()})),t}})():c(a?a(i):i)}catch(t){throw e.dispatch(en({id:n,message:t.toString()})),t}}}var ep="@iiif/SET_META_VALUE",eh="@iiif/SET_META_VALUE_DYNAMIC",ef="@iiif/UNSET_META_VALUE",eg=$(ep)(),ev=$(eh)(),ey=($(ef)(),{setMetaValue:eg,setMetaValueDynamic:ev});function eb(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}let ex={};var ew=e=>{let t,i=new Set,n=(e,n)=>{let r="function"==typeof e?e(t):e;if(!Object.is(r,t)){let e=t;t=n??("object"!=typeof r||null===r)?r:Object.assign({},t,r),i.forEach(i=>i(t,e))}},r=()=>t,a={setState:n,getState:r,getInitialState:()=>o,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{(ex?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},o=t=e(n,r,a);return a},eE=e=>e?ew(e):ew;let eS={};var eC=(e,t)=>(i,n,r)=>(r.dispatch=t=>(i(i=>e(i,t),!1,t),t),r.dispatchFromDevtools=!0,{dispatch:(...e)=>r.dispatch(...e),...t}),eA=new Map,ek=e=>{let t=eA.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},eI=(e,t,i)=>{if(void 0===e)return{type:"untracked",connection:t.connect(i)};let n=eA.get(i.name);if(n)return{type:"tracked",store:e,...n};let r={connection:t.connect(i),stores:{}};return eA.set(i.name,r),{type:"tracked",store:e,...r}},eR=(e,t={})=>(i,n,r)=>{let a,{enabled:o,anonymousActionType:l,store:s,...c}=t;try{a=(o??(eS?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!a)return(eS?"production":void 0)!=="production"&&o&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(i,n,r);let{connection:d,...u}=eI(s,a,c),m=!0;r.setState=(e,t,a)=>{let o=i(e,t);if(!m)return o;let u=void 0===a?{type:l||"anonymous"}:"string"==typeof a?{type:a}:a;return void 0===s?null==d||d.send(u,n()):null==d||d.send({...u,type:`${s}/${u.type}`},{...ek(c.name),[s]:r.getState()}),o};let p=(...e)=>{let t=m;m=!1,i(...e),m=t},h=e(r.setState,n,r);if("untracked"===u.type?null==d||d.init(h):(u.stores[u.store]=r,null==d||d.init(Object.fromEntries(Object.entries(u.stores).map(([e,t])=>[e,e===u.store?h:t.getState()])))),r.dispatchFromDevtools&&"function"==typeof r.dispatch){let e=!1,t=r.dispatch;r.dispatch=(...i)=>{(eS?"production":void 0)==="production"||"__setState"!==i[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...i)}}return d.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return void console.error("[zustand devtools middleware] Unsupported action format");return eT(e.payload,e=>{if("__setState"===e.type){if(void 0===s)return void p(e.state);1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[s];return void(null==t||JSON.stringify(r.getState())!==JSON.stringify(t)&&p(t))}r.dispatchFromDevtools&&"function"==typeof r.dispatch&&r.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return p(h),void 0===s?null==d?void 0:d.init(r.getState()):null==d?void 0:d.init(ek(c.name));case"COMMIT":if(void 0===s){null==d||d.init(r.getState());break}return null==d?void 0:d.init(ek(c.name));case"ROLLBACK":return eT(e.state,e=>{if(void 0===s){p(e),null==d||d.init(r.getState());return}p(e[s]),null==d||d.init(ek(c.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return eT(e.state,e=>{if(void 0===s)return void p(e);JSON.stringify(r.getState())!==JSON.stringify(e[s])&&p(e[s])});case"IMPORT_STATE":{let{nextLiftedState:i}=e.payload,n=null==(t=i.computedStates.slice(-1)[0])?void 0:t.state;if(!n)return;p(void 0===s?n:n[s]),null==d||d.send(null,i);break}case"PAUSE_RECORDING":return m=!m}return}}),h},eT=(e,t)=>{let i;try{i=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==i&&t(i)},eO=e=>(t,i,n)=>{let r=n.subscribe;return n.subscribe=(e,t,i)=>{let a=e;if(t){let r=(null==i?void 0:i.equalityFn)||Object.is,o=e(n.getState());a=i=>{let n=e(i);if(!r(o,n)){let e=o;t(o=n,e)}},null!=i&&i.fireImmediately&&t(o,o)}return r(a)},e(t,i,n)};function e$(e,t,i,n){return!(!e[i]||!e[i][t]||!e[i][t][n]||!Array.isArray(e[i][t][n]))}function eL(e){return e.payload}function eM(e,t){return typeof e>"u"?t:e}function eP(e={}){let t=Object.keys(e);return function(i={},n){let r=!1,a={};for(let o=0;o<t.length;o++){let l=t[o];a[l]=e[l](i[l],n),r=r||a[l]!==i[l]}return r?a:i}}var eF=eP({mapping:(e={},t)=>{switch(t.type){case q:return{...e,[t.payload.id]:t.payload.type};case U:return{...e,...t.payload.mapping};default:return e}},entities:(e=eb(),t)=>{var i;let n=(i,n)=>({...e,[eL(t).type]:{...e[eL(t).type],[eL(t).id]:{...i,...n}}});switch(t.type){case M:{if(!e[eL(t).type]||!e[eL(t).type][eL(t).id])return e;let i=e[eL(t).type][eL(t).id];return"string"==typeof i?e:n(i,{[eL(t).key]:eL(t).value})}case P:{if(!e$(e,eL(t).id,eL(t).type,eL(t).key))return e;let i=e[eL(t).type][eL(t).id];if("string"==typeof i)return e;let r=Array.from(i[eL(t).key]),[a]=r.splice(eL(t).startIndex,1);return r.splice(eL(t).endIndex,0,a),n(i,{[eL(t).key]:r})}case L:{let i=Object.keys(eL(t).entities),n={...e};for(let r of i){let i=eL(t).entities[r],a={...e[r]||{}},o=!1,l=Object.keys(i||{})||[];if(i&&l){for(let t of l)o=!0,a[t]=e[r][t]?function(e,t){let i={},n=[];for(let[r,a]of Object.entries(e||{})){n.push(r);let e=(t||{})[r];if(!e||0===e.length){i[r]=a;continue}i[r]=e}for(let[e,r]of Object.entries(t||{}))-1===n.indexOf(e)&&(i[e]=r);return i}(e[r][t],i[t]):i[t];o&&(n[r]=a)}}return n}case F:{if(!e$(e,eL(t).id,eL(t).type,eL(t).key))return e;let i=e[eL(t).type][eL(t).id],r=Array.from(i[eL(t).key]);return r.splice(eM(eL(t).index,r.length+1),0,eL(t).reference),n(i,{[eL(t).key]:r})}case j:case z:{if(!e$(e,eL(t).id,eL(t).type,eL(t).key))return e;let r=e[eL(t).type][eL(t).id],a=Array.from(r[eL(t).key]),o=eM(eL(t).index,a.findIndex(e=>e&&e.id===eL(t).reference.id));return -1===o||(null==(i=a[o])?void 0:i.id)!==eL(t).reference.id?e:(t.type===j?a.splice(o,1,eL(t).reference):a.splice(o,1),n(r,{[eL(t).key]:a}))}case _:{let i=e[eL(t).type][eL(t).id];if(!i)return e;let r=Array.from(i.metadata||[]),a=eL(t);return r.splice(eM(t.payload.beforeIndex,r.length+1),0,{label:a.label,value:a.label}),n(i,{metadata:r})}case D:{let i=e[eL(t).type][eL(t).id];if("string"==typeof i||!i)return e;let r=Array.from(i.metadata||[]),[a]=r.splice(eL(t).startIndex,1);return r.splice(eL(t).endIndex,0,a),n(i,{metadata:r})}case B:case H:{let i=e[eL(t).type][eL(t).id],r=Array.from(i.metadata||[]),a=eL(t).atIndex;return typeof a>"u"||-1===a||!r[a]?e:(t.type===B?r.splice(a,1,{label:eL(t).label,value:eL(t).value}):r.splice(a,1),n(i,{metadata:r}))}default:return e}},requests:(e={},t)=>{switch(t.type){case Y:case"@iiif/REQUEST_OFFLINE_RESOURCE":return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:Z,uriMismatch:!1,resourceUri:t.payload.id}};case ee:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case K:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:J,error:t.payload.message}};case et:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:X,error:void 0}}}return e},meta:(e={},t)=>{let{id:i,updateValue:n,value:r,meta:a,key:o}=t&&t.payload||{};switch(t.type){case ep:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:r}}};case eh:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:n(e[i]&&e[i][a]?e[i][a][o]:void 0)}}};case ef:return e[i]&&e[i][a]&&e[i][a][o]?{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:void 0}}}:e;default:return e}}});function ej(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map(function(e){e(i)}),(n=e.get("*"))&&n.slice().map(function(e){e(t,i)})}}}var ez=Object.defineProperty,e_=(e,t,i)=>t in e?ez(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,eH=(e,t,i)=>(e_(e,"symbol"!=typeof t?t+"":t,i),i);function eB(e,t,i,n=!0){t[eN]=t[eN]||[],t[eN].push(e);let r=new Map;Object.defineProperty(t,e,{enumerable:n,get(){if(typeof t[eD][e]>"u")return;let n=t[eD][e];if(!n)return n;let a=i.get(t[eD][e],{parent:this.id?{id:this.id,type:this.type}:void 0});return r.has(a)||(r.clear(),r.set(a,eq(a,i))),r.get(a)},set(n){t[eD][e]!==n&&(this[eV]?i.modifyEntityField({id:this.id,type:this.type},e,function e(t){return Array.isArray(t)?t.map(t=>e(t)):t&&t.type?{id:t.id,type:t.type}:t}(n)):this[eD][e]=n)}})}var eD=Symbol.for("_refs_"),eV=Symbol.for("_reactive_"),eN=Symbol.for("_defined_"),eW=Symbol.for("_parent_");function eq(e,t,i=!1,n){if(Array.isArray(e))return e.map(e=>eq(e,t,i));if(!e||!e.type||!e.id)return e;let r=Object.assign(Object.create(function(e,t=!1,i){let n={id:"",type:"unknown",[eN]:[],[eD]:{},[eW]:null,[eV]:null,is(e){return"string"==typeof e?this.id===e:!!e.id&&e.id===this.id},reactive(){if(!this[eV])return this[eV]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let e=this.unwrap();for(let t of Object.keys(e||{}))this[eN].includes(t)?this[eD][t]=e[t]:this[t]=e[t]}},unreactive(){this[eV]&&(this[eV](),this[eV]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let t=this[eW];return e.get(this.id,{parent:t?{id:t,type:"unknown"}:void 0})},toPresentation3(){return e.toPresentation3(this.unwrap())},toPresentation2(){return e.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(t,i=!0){return e.subscribe(()=>this.id?e.get(this.id):null,t,i)}};return eB("items",n,e),eB("annotations",n,e),eB("structures",n,e),eB("seeAlso",n,e),eB("rendering",n,e),eB("partOf",n,e),eB("start",n,e,!1),eB("supplementary",n,e),eB("homepage",n,e),eB("thumbnail",n,e),eB("placeholderCanvas",n,e,!1),eB("accompanyingCanvas",n,e,!1),eB("provider",n,e),eB("body",n,e),eB("logo",n,e),n}(t,i)),e);return i&&r.reactive(),r}function eU(e){switch(e){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return e}var eQ=class{constructor(e,t){eH(this,"options"),eH(this,"store"),eH(this,"emitter"),eH(this,"isBatching",!1),eH(this,"batchQueue",[]),eH(this,"remoteFetcher"),eH(this,"staticFetcher"),eH(this,"defaultFetcher",e=>fetch(e).then(e=>{if(200===e.status)return e.json();{let t=Error(`${e.status} ${e.statusText}`);throw t.name="HTTPError",t}})),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){var t;let{enableDevtools:i=!1,iiifStoreName:n="iiif",defaultState:r={iiif:{entities:eb(),meta:{},mapping:{},requests:{}}},customReducers:a={}}=e,o=(t=eP({[n]:eF,...a}),(e,i)=>i&&i.type===eo?i.payload.actions.reduce(t,e):i&&"@iiif/BATCH_IMPORT"===i.type?{...e,iiif:{...e.iiif,...i.payload.state}}:t(e,i));return eE(eO(("u">typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?eR:(e,t)=>e)(eC(o,r),{enabled:i})))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=ej(),this.remoteFetcher=em(this,this.options.customFetcher),this.staticFetcher=em(this,(e,t)=>t)}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(el({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(el({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}modifyEntityField(e,t,i){this.dispatch(W.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===eo){for(let t of e.payload.actions)this.emitter.emit(t.type,{action:t,state:this.store.getState()});this.store.dispatch(e);let t=this.getState();for(let i of e.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);let t=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:t});return}}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}serialize(e,t){return(0,d.B)(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,d.E)}toPresentation3(e){return this.serialize(e,d.F)}hydrate(e,t,i={}){return this.get(e,t,{...i,skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);let{skipSelfReturn:n=!0}=i||{},r=i.parent?"string"==typeof i.parent?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map(e=>this.get(e,i));let a=this.getState();if((0,u.a)(e)&&!i.preserveSpecificResources&&(e=e.source),"string"==typeof e){let i=eU(t||a.iiif.mapping[e]);if(!i)return n?null:{id:e,type:"unknown"};e={id:e,type:i}}if(e&&e.partOf&&!r&&!i.skipPartOfCheck){let t=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;t&&("string"==typeof t&&(r=t),"string"==typeof t.id&&(r=t.id))}let o=eU(t||(null==e?void 0:e.type)),l=null==e?void 0:e.id,s=a.iiif.entities[o];if(!s){let t=a.iiif.requests[l];return t&&t.resourceUri!==l?this.get(t.resourceUri,i):n?null:e}let c=s[e.id];if(c&&c[d.c]){let e=c[d.c].find(e=>r?e[d.d]===r:e[d.d]===c.id);return(0,d.j)(c,e)}return s[e.id]||(n?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,t){if(typeof e>"u")return this.get(t,{skipSelfReturn:!1});if("function"==typeof e)try{let i=e(this.get(t,{skipSelfReturn:!1})),n=e=>this.deep(e,i);return n.size=Array.isArray(i)?i.length:1,n}catch{let e=e=>this.deep(e,void 0);return e.size=0,e}let i=t=>this.deep(t,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,t,i){let n="string"==typeof e?e:e.id;return this.load(n,t,i)}loadCollection(e,t,i){let n="string"==typeof e?e:e.id;return this.load(n,t,i)}load(e,t,i){let n="string"==typeof e?e:e.id;return t?Promise.resolve(this.staticFetcher(n,t,i)):Promise.resolve(this.remoteFetcher(n,{},i))}loadSync(e,t,i){let n="string"==typeof e?e:e.id;return this.staticFetcher(n,t,i)}loadManifestSync(e,t,i){let n="string"==typeof e?e:e.id;return this.loadSync(n,t,i)}loadCollectionSync(e,t,i){let n="string"==typeof e?e:e.id;return this.loadSync(n,t,i)}areInputsEqual(e,t){return ed(e,t)}subscribe(e,t,i){return typeof i>"u"&&(typeof t>"u"||!1===t||!0===t)&&(i=t,t=e,e=e=>e),this.store.subscribe(e,e=>t(e,this),{equalityFn:ed,fireImmediately:!i})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getPaginationState(e){let t="string"==typeof e?e:e.id;if(!t)return null;let i=this.getResourceMeta(t,"@vault/pagination");if(null!=i&&i.state)return i.state;let n=this.get(e);if(n.first){let e={currentPage:null,currentPageIndex:null,isFetching:!1,isFullyLoaded:!1,next:n.first,page:1,pages:[],previous:null,totalItems:n.total,currentLength:0};return this.setMetaValue([t,"@vault/pagination","state"],e),e}return null}async loadNextPage(e,t){var i;let n,r="string"==typeof e?e:e.id;if(!r)return[null,null];let a=this.getPaginationState(e);if(!a||a.isFullyLoaded||!a.next)return[null,null];if(a.isFetching)return[a,null];let o="string"==typeof a.next?a.next:a.next.id,l=a.currentPage,s={...a,isFetching:!0};this.setMetaValue([r,"@vault/pagination","state"],s);try{n=await this.loadCollection(o,t,e=>{let{id:t,"@id":i,...n}=e||{};return i?{"@id":o,...n}:{id:o,...n}})}catch(t){let e={...a,isFetching:!1,error:t};return this.setMetaValue([r,"@vault/pagination","state"],e),[e,null]}if(!n){let e={...a,isFetching:!1,error:Error("Collection not found")};return this.setMetaValue([r,"@vault/pagination","state"],e),[e,null]}let c=this.get(r),d=[...c.items||[],...n.items||[]].map(e=>({id:e.id,type:e.type}));this.modifyEntityField({id:r,type:"Collection"},"items",d);let u=this.getPaginationState(e);if(!u)throw Error("Pagination state not found");let m={...u,isFetching:!1,error:null,currentPage:n.id,next:(null==(i=n.next)?void 0:i.id)||null,currentPageIndex:u.pages.length,currentLength:d.length,pages:[...u.pages,{id:n.id,type:"Collection",startIndex:c.items.length,pageLength:n.items.length,order:"number"==typeof u.currentPageIndex?u.currentPageIndex+1:0}],isFullyLoaded:!n.next,previous:l,page:u.pages.length+1};return this.setMetaValue([r,"@vault/pagination","state"],m),[m,n]}getResourceMeta(e,t){let i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}getObject(e,t,i={}){let{reactive:n,...r}=i;return eq(this.get(e,t,r),this,n)}async loadObject(e,t){return eq(await this.load(e,t),this)}async loadManifestObject(e,t){return eq(await this.loadManifest(e,t),this)}async loadCollectionObject(e,t){return eq(await this.loadCollection(e,t),this)}wrapObject(e){return eq(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return!!e[eN]}setMetaValue([e,t,i],n){this.dispatch("function"==typeof n?ey.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:n}):ey.setMetaValue({id:e,meta:t,key:i,value:n}))}};let eG=e=>{let t=e.toString().split(":"),i=Math.ceil(parseInt(t[0])),n=Math.ceil(parseInt(t[1])),r=eK(Math.ceil(parseInt(t[2])),2),a=`${0!==i&&n<10?(n+"").padStart(2,"0"):n}:${r}`;return 0!==i&&(a=`${i}:${a}`),a},eJ=e=>eG(new Date(1e3*e).toISOString().substr(11,8)),eZ=(e,t)=>{if("object"!=typeof e||null===e)return t;for(let i in t)"object"!=typeof t[i]||null===t[i]||Array.isArray(t[i])?e[i]=t[i]:(e[i]||(e[i]={}),e[i]=eZ(e[i],t[i]));return e},eX=e=>e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0),eY=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,eK=(e,t)=>String(e).padStart(t,"0"),e0={behavior:"smooth",block:"center"},e1={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:"anonymous",ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:e0}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1};function e2(e){var t,i;let n=(null==(i=null==(t=null==e1?void 0:e1.informationPanel)?void 0:t.vtt)?void 0:i.autoScroll)||{enabled:!0,settings:e0};if(null==e)return{enabled:n.enabled,settings:{...n.settings}};if("boolean"==typeof e)return{enabled:e,settings:{...n.settings}};if("enabled"in e)return{enabled:e.enabled,settings:{...e.settings}};let r={enabled:!0,settings:{...e}};return function({behavior:e,block:t}){let i=["auto","instant","smooth"],n=["center","end","nearest","start"];if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`);if(!n.includes(t))throw TypeError(`'${t}' not in ${n.join(" | ")}`)}(r.settings),r}let e3=e2(null==(r=null==(n=null==e1?void 0:e1.informationPanel)?void 0:n.vtt)?void 0:r.autoScroll),e4={activeCanvas:"",activeManifest:"",activePlayer:null,activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:e1,customDisplays:[],plugins:[],isAutoScrollEnabled:e3.enabled,isAutoScrolling:!1,isInformationOpen:(null==(a=null==e1?void 0:e1.informationPanel)?void 0:a.open)??!0,isLoaded:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new eQ,openSeadragonViewer:null,viewerId:(0,m.A)(),visibleCanvases:[],visibleAnnotations:[]},e5=c.createContext(e4),e6=c.createContext(e4);function e8(e,t){switch(t.type){case"updateActiveCanvas":return t.canvasId||(t.canvasId=""),{...e,activeCanvas:t.canvasId};case"updateActiveManifest":return{...e,activeManifest:t.manifestId};case"updateActivePlayer":return{...e,activePlayer:t.player};case"updateOSDImageLoaded":return{...e,OSDImageLoaded:t.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...e,isAutoScrollEnabled:t.isAutoScrollEnabled};case"updateAutoScrolling":return{...e,isAutoScrolling:t.isAutoScrolling};case"updateCollection":return{...e,collection:t.collection};case"updateConfigOptions":return{...e,configOptions:eZ(e.configOptions,t.configOptions)};case"updateContentStateAnnotation":return{...e,contentStateAnnotation:t.contentStateAnnotation};case"updateInformationOpen":return{...e,isInformationOpen:t.isInformationOpen};case"updateInformationPanelResource":return{...e,informationPanelResource:t.informationPanelResource};case"updateIsLoaded":return{...e,isLoaded:t.isLoaded};case"updateManifestSequence":return{...e,sequence:t.sequence};case"updateUserScrolling":return{...e,isUserScrolling:t.isUserScrolling};case"updateOpenSeadragonViewer":return{...e,openSeadragonViewer:t.openSeadragonViewer};case"updateViewerId":return{...e,viewerId:t.viewerId};case"updateActiveSelector":return{...e,activeSelector:t.selector};case"updateVisibleCanvases":return{...e,visibleCanvases:t.visibleCanvases};default:throw Error(`Unhandled action type: ${t.type}`)}}let e7=({initialState:e=e4,children:t})=>{let[i,n]=(0,c.useReducer)(e8,e),{openSeadragonViewer:r}=i;return(0,c.useEffect)(()=>{if(r)return r.addHandler("update-viewport",()=>{let e=r.viewport,t=e.getBounds(),i=e.viewportToImageRectangle(t);n({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:`xywh=${[Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height)].join(",")}`}})}),()=>{r.removeAllHandlers("update-viewport")}},[r]),c.createElement(e5.Provider,{value:i},c.createElement(e6.Provider,{value:n},t))};function e9(){let e=c.useContext(e5);if(void 0===e)throw Error("useViewerState must be used within a ViewerProvider");return e}function te(){let e=c.useContext(e6);if(void 0===e)throw Error("useViewerDispatch must be used within a ViewerProvider");return e}let tt=async(e,t)=>{let i=e.get({id:t,type:"Canvas"});if(!(null!=i&&i.annotations)||!i.annotations[0])return[];let n=e.get(i.annotations).filter(e=>!!e.items&&e),r=[];for(let t of n)if(t.items.length>0){let e=t.label||{none:["Annotations"]};r.push({...t,label:e})}else{let i={};try{i=await e.load(t.id)}catch(e){console.log(e)}if(i.items&&i.items.length>0){let e=i.label||{none:["Annotations"]};r.push({...i,label:e})}}return r},ti=async(e,t,i)=>{try{if(null==i||null==i.q)return{};let n=i.q.trim(),r=new URL(t);return r.searchParams.set("q",n),await e.load(r.toString())}catch(e){return console.warn("Error in getContentSearchResources:",e),{}}},tn=(e,t,i,n)=>{var r,a;let o={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]};if(o.canvas=e.get(t),o.canvas&&(o.annotationPage=e.get(o.canvas.items[0]),o.accompanyingCanvas=null!=(r=o.canvas)&&r.accompanyingCanvas?e.get(null==(a=o.canvas)?void 0:a.accompanyingCanvas):void 0),o.annotationPage){let r=e.get(o.annotationPage.items).map(t=>({body:e.get(t.body[0].id),motivation:t.motivation,type:"Annotation"})),a=[];r.forEach(t=>{"Choice"===t.body.type?t.body.items.forEach(i=>a.push({...t,id:i.id,body:e.get(i.id)})):a.push(t)}),o.annotations=a.filter(r=>{if(r){if(!r.body||!r.motivation)return void console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",r);let a=r.body;Array.isArray(a)&&(a=a[0]);let o=e.get(a.id);if(o)switch(i){case"painting":return r.target===t.id&&r.motivation&&"painting"===r.motivation[0]&&n.includes(o.type)&&(r.body=o),!!r;case"supplementing":return;default:throw Error("Invalid annotation motivation.")}}})}return o},tr=(e,t="en")=>{if(!e)return"";if(!e[t]){let t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]},ta=(e,t)=>{let i=tn(e,{id:t,type:"Canvas"},"painting",["Image","Sound","Video"]);if(0!==i.annotations.length&&i.annotations&&i.annotations)return i.annotations.map(e=>null==e?void 0:e.body)},to={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:tl,css:ts,keyframes:tc,createTheme:td}=(0,v.GC)({theme:{colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media:to}),tu=tl("div",{display:"flex",flexDirection:"column",alignItems:"center"}),tm=tl("p",{fontWeight:"bold",fontSize:"x-large"}),tp=tl("span",{fontSize:"medium"}),th=({error:e})=>{let{message:t}=e;return c.createElement(tu,{role:"alert"},c.createElement(tm,{"data-testid":"headline"},"Something went wrong"),t&&c.createElement(tp,null,`Error message: ${t}`," "))},tf=tl("div",{position:"relative",zIndex:"0"}),tg=tl("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),tv=tl("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),ty=tl("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),tb=tl("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${tg}`]:{flexGrow:"1"},[`& ${tv}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}}),tx=tl(y.bL,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),tw=tl(y.B8,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),tE=tl(y.l9,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),tS=tl(y.UC,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),tC=tl(({handleScroll:e,children:t,className:i})=>c.createElement("div",{className:i,onScroll:e},t),{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),tA={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},tk=tl("button",{textAlign:"left","&:hover":{color:"$accent"}}),tI=tl("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),tR=tl("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),tT=tl("div",{...tA,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},[`&[dir=rtl] ${tR}`]:{textAlign:"right !important"}}),tO=({value:e,handleClick:t})=>c.createElement(tk,{onClick:t},c.createElement(tR,{dangerouslySetInnerHTML:{__html:e}})),t$=({caption:e,handleClick:t,imageUri:i})=>c.createElement(tk,{onClick:t},c.createElement("img",{src:i,alt:`A visual annotation for ${e}`}),c.createElement("span",null,e)),tL=({value:e,handleClick:t})=>{let i=(0,b.A)(e);return c.createElement(tk,{onClick:t},c.createElement(tR,{dangerouslySetInnerHTML:{__html:i.html}}))},tM=({value:e,handleClick:t,isContentSearch:i})=>c.createElement(tk,{onClick:t},c.createElement(tR,{dangerouslySetInnerHTML:{__html:e},"data-content-search":i})),tP=()=>{function e(e){return e.map(e=>{let t=e.identifier||(0,m.A)();return{...e,identifier:t}})}return{addIdentifiersToParsedCues:e,createNestedCues:function(t){var i;let n=[],r=[];for(let a of e(t)){for(;r.length>0&&r[r.length-1].end<=a.start;)r.pop();r.length>0?(r[r.length-1].children||(r[r.length-1].children=[]),null==(i=r[r.length-1].children)||i.push(a)):n.push(a),r.push(a)}return n},isChild:function(e,t=[]){return t.some(t=>e.start>=t.start&&e.end<=t.end)},orderCuesByTime:function(e=[]){return e.sort((e,t)=>e.start-t.start)},parseVttData:function(e){return new Promise((t,i)=>{let n=x.parse(e);n.errors&&n.errors.length&&i(n.errors),t(n.cues.map(e=>({identifier:e.identifier||(0,m.A)(),start:e.start,end:e.end,align:e.align,html:function(e){let t=function(e){let t=e.replace(/<(c|v|i|b|u|lang|ruby)(?:\.([^\s>]+))?(?:\s([^>]+))?>/g,(e,t,i,n)=>{let r=document.createElement(t);return i&&(r.className=i.replace(/\./g," ")),(null==n?void 0:n.length)>0&&(r.title=n),r.outerHTML.replace(RegExp(`</${t}>$`),"")});return console.log("normalizeVttTags",t),t}(e),i=document.createElement("div");return i.innerHTML=t,function e(t){var i;for(let i of t.children)e(i);if("c"===t.localName||"v"===t.localName){let e=document.createElement("span");for(let i of t.attributes)e.setAttribute(i.name,i.value);e.innerHTML=t.innerHTML,null==(i=t.parentNode)||i.replaceChild(e,t)}}(i),i.innerHTML}(e.text),text:e.text||""})))})}}},tF=tl(w.bL,{display:"flex",flexDirection:"column",width:"100%"}),tj=tl(w.q7,{...tA,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),tz=e=>{for(;e&&e!==document.body;){let t=window.getComputedStyle(e).overflowY;if("visible"!==t&&"hidden"!==t&&e.scrollHeight>e.clientHeight)return e;e=e.parentNode}return null},t_=({html:e,text:t,start:i,end:n})=>{var r,a;let o=te(),{activePlayer:l,configOptions:s,isAutoScrollEnabled:d,isUserScrolling:u}=e9(),m=null==(a=null==(r=null==s?void 0:s.informationPanel)?void 0:r.vtt)?void 0:a.autoScroll,[p,h]=(0,c.useState)(!1),f=(0,c.useRef)(null);return(0,c.useEffect)(()=>(null==l||l.addEventListener("timeupdate",()=>{let{currentTime:e}=l;h(i<=e&&e<n)}),()=>document.removeEventListener("timeupdate",()=>{})),[n,i,l]),(0,c.useEffect)(()=>{var e;if(d&&p&&f.current&&!u){let t=f.current;if(t&&t instanceof HTMLElement){let i=tz(t);if(i&&i instanceof HTMLElement){let n;switch(null==(e=null==m?void 0:m.settings)?void 0:e.block){case"center":let r=i.getBoundingClientRect();n=t.offsetTop+t.offsetHeight-Math.floor((r.bottom-r.top)/2);break;case"end":n=t.offsetTop+t.offsetHeight-(i.clientHeight-t.clientHeight)+2;break;default:n=t.offsetTop-2}o({type:"updateAutoScrolling",isAutoScrolling:!0}),(()=>{var e;return i.scrollTo({top:n,left:0,behavior:null==(e=null==m?void 0:m.settings)?void 0:e.behavior})})(),setTimeout(()=>o({type:"updateAutoScrolling",isAutoScrolling:!1}),750)}}}},[m,p,u,d,o]),c.createElement(tj,{ref:f,"aria-checked":p,"data-testid":"information-panel-cue",onClick:()=>{l&&(l.pause(),l.currentTime=i,l.play())},value:t},c.createElement("div",{className:"webvtt-cue",dangerouslySetInnerHTML:{__html:e}}),c.createElement("strong",null,eJ(i)))},tH=tl("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${tj}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),tB=({items:e})=>c.createElement(tH,null,e.map(e=>{let{html:t,text:i,start:n,end:r,children:a,identifier:o}=e;return c.createElement("li",{key:o},c.createElement(t_,{html:t,text:i,start:n,end:r}),a&&c.createElement(tB,{items:a}))})),tD=({inlineCues:e,label:t,vttUri:i})=>{let[n,r]=c.useState(e||[]),{createNestedCues:a,orderCuesByTime:o,parseVttData:l}=tP(),[s,d]=c.useState();return(0,c.useEffect)(()=>{!e&&i&&fetch(i,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(e=>e.text()).then(e=>{l(e).then(e=>{r(a(o(e)))})}).catch(e=>{console.error(i,e.toString()),d(e)})},[i,e]),c.createElement(tF,{"data-testid":"annotation-item-vtt","aria-label":`${tr(t)}`},s&&c.createElement("div",{"data-testid":"error-message"},"Network Error: ",s.toString()),c.createElement(tB,{items:n}))},tV=e=>{var t;return e&&["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"].includes(Array.isArray(e)?null==(t=e[0])?void 0:t.split("-")[0]:null==e?void 0:e.split("-")[0])?"RTL":"LTR"},tN=e=>{var t,i,n,r,a;let o={id:"string"==typeof e?e:e.source};if("string"==typeof e){if(e.includes("#xywh=")){let t=e.split("#xywh=");if(t&&t[1]){let[e,i,n,r]=t[1].split(",").map(e=>Number(e));o={id:t[0],rect:{x:e,y:i,w:n,h:r}}}}else if(e.includes("#t=")){let t=e.split("#t=");t&&t[1]&&(o={id:t[0],t:t[1]})}}else if("object"==typeof e){if((null==(t=e.selector)?void 0:t.type)==="PointSelector")o={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if((null==(i=e.selector)?void 0:i.type)==="SvgSelector")o={id:e.source,svg:e.selector.value};else if((null==(n=e.selector)?void 0:n.type)==="FragmentSelector"&&null!=(r=e.selector)&&r.value.includes("xywh=")&&"Canvas"==e.source.type&&e.source.id){let t=null==(a=e.selector)?void 0:a.value.split("xywh=");if(t&&t[1]){let[i,n,r,a]=t[1].split(",").map(e=>Number(e));o={id:e.source.id,rect:{x:i,y:n,w:r,h:a}}}}}return o},tW=({annotation:e,targetResource:t,isContentSearch:i,isContentState:n})=>{var r,a,o,l,s,d,u;let{target:m}=e,p=null==(r=null==m?void 0:m.selector)?void 0:r.type,h=(null==(o=null==(a=null==m?void 0:m.selector)?void 0:a.value)?void 0:o.split("=")[1])||"full",[f,g]="full"!==h?null==h?void 0:h.split(",").slice(2):[100,100],v=`${t}/${h}/!${((e,t)=>{let i=Math.max(e,t);return[Math.round(e/i*100),Math.round(t/i*100)].join(",")})(f,g)}/0/default.jpg`,y=e9(),b=te(),{openSeadragonViewer:x,vault:w,visibleCanvases:E}=y,S=null!=e&&e.body?null==(l=null==e?void 0:e.body)?void 0:l.map(e=>w.get(e.id)):[],{format:C="PointSelector"===p?"text/vtt":"text/plain",language:A="none",value:k="",chars:I=""}=S[0]?S[0]:{},R="PointSelector"===p?"text/vtt":C,T=(null==(s=S[0])?void 0:s.label)||{none:["t"]},O=k||I||"None",$=A?tV(A).toLocaleLowerCase():"LTR",L="PointSelector"===p&&null!=(d=null==m?void 0:m.selector)&&d.t?[{start:null==(u=null==m?void 0:m.selector)?void 0:u.t,end:0,html:O,text:O,styles:"",children:[]}]:void 0;function M(){var t;let i=null==x?void 0:x.getOverlayById(e.id);if(i&&null!=x&&x.viewport){null!=i&&i.element&&(null==(t=i.element)||t.focus());let e=null==i?void 0:i.getBounds(x.viewport);e.x-=.2,e.y-=.2,e.width+=.5,e.height+=.5,x.viewport.fitBounds(e,!1)}}function P(t){var i;t.preventDefault(),t.stopPropagation();let n=(null==(i=null==e?void 0:e.target)?void 0:i.source)||(null==e?void 0:e.target),r=null==n?void 0:n.id;E.map(e=>e.id).includes(r)?M():b({type:"updateActiveCanvas",canvasId:r})}if((0,c.useEffect)(()=>{if(!x||!n)return;let t=setInterval(()=>{(null==x?void 0:x.getOverlayById(e.id))&&(M(),x.container.className="clover-iiif-content-state",clearInterval(t))},1e3);return()=>clearInterval(t)},[x,n]),C)return c.createElement(tT,{dir:$,"data-format":C,"data-content":O,className:"clover-iiif-annotation-item"},c.createElement("span",{style:{backgroundImage:`url(${v})`,backgroundSize:"cover",backgroundPosition:"center"}}),function(){var e,t,n;switch(R){case"text/plain":return c.createElement(tM,{value:O,handleClick:P,isContentSearch:i});case"text/html":return c.createElement(tO,{value:O,handleClick:P});case"text/markdown":return c.createElement(tL,{value:O,handleClick:P});case"text/vtt":return c.createElement(tD,{inlineCues:L,label:T,vttUri:(null==(e=S[0])?void 0:e.id)||void 0});case null==(t=null==C?void 0:C.match(/^image\//))?void 0:t.input:let r=(null==(n=S.find(e=>{var t;return!(null!=(t=e.id)&&t.includes("vault://"))}))?void 0:n.id)||"";return c.createElement(t$,{caption:k,handleClick:P,imageUri:r});default:return c.createElement(tM,{value:O,handleClick:P})}}())},tq=(e,t="none")=>{if(!e)return null;if("string"==typeof e)return[e];if(!e[t]){let t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]&&Array.isArray(e[t])?e[t]:null},tU=(e,t="none",i=", ")=>{let n=tq(e,t);return Array.isArray(n)?n.join(`${i}`):n};function tQ(e,t){let i=Object.keys(e).filter(e=>t.includes(e)?null:e),n={};return i.forEach(t=>{n[t]=e[t]}),n}let tG=tl("span",{}),tJ=e=>{let{as:t,label:i}=e,n=tQ(e,["as","label"]);return c.createElement(tG,{as:t,...n},tU(i,n.lang))},tZ=(e,t="200,",i="full")=>{let n;Array.isArray(e)&&(e=e[0]);let{id:r,service:a}=e;if(!a)return r;if(Array.isArray(e.service)&&e.service.length>0&&(n=a[0]),n){if(n["@id"])return`${n["@id"]}/${i}/${t}/0/default.jpg`;if(n.id)return`${n.id}/${i}/${t}/0/default.jpg`}},tX=tl("img",{objectFit:"cover"}),tY=e=>{let t,i=(0,c.useRef)(null),{contentResource:n,altAsLabel:r,region:a="full"}=e;r&&(t=tU(r));let o=tQ(e,["contentResource","altAsLabel"]),{type:l,id:s,width:d=200,height:u=200,duration:m}=n;(0,c.useEffect)(()=>{if(!s&&!i.current||["Image"].includes(l)||!s.includes("m3u8"))return;let e=new S.Ay;return i.current&&(e.attachMedia(i.current),e.on(S.Ay.Events.MEDIA_ATTACHED,function(){e.loadSource(s)})),e.on(S.Ay.Events.ERROR,function(t,i){if(i.fatal)switch(i.type){case S.Ay.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${t} network error encountered, try to recover`),e.startLoad();break;case S.Ay.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${t} media error encountered, try to recover`),e.recoverMediaError();break;default:e.destroy()}}),()=>{e&&(e.detachMedia(),e.destroy())}},[s,l]);let p=(0,c.useCallback)(()=>{if(!i.current)return;let e=0,t=30;if(m&&(t=m),!s.split("#t=")&&m&&(e=.1*m),s.split("#t=").pop()){let t=s.split("#t=").pop();t&&(e=parseInt(t.split(",")[0]))}let n=i.current;n.autoplay=!0,n.currentTime=e,setTimeout(()=>p(),1e3*t)},[m,s]);(0,c.useEffect)(()=>p(),[p]);let h=tZ(n,`${d},${u}`,a);switch(l){case"Image":return c.createElement(tX,{as:"img",alt:t,css:{width:d,height:u},key:s,src:h,...o});case"Video":return c.createElement(tX,{as:"video",css:{width:d,height:u},disablePictureInPicture:!0,key:s,loop:!0,muted:!0,onPause:p,ref:i,src:s});default:return console.warn(`Resource type: ${l} is not valid or not yet supported in Primitives.`),c.createElement(c.Fragment,null)}},tK=tl("a",{}),t0=e=>{let{children:t,homepage:i}=e,n=tQ(e,["children","homepage"]);return c.createElement(c.Fragment,null,i&&i.map(e=>{let i=tU(e.label,n.lang);return c.createElement(tK,{"aria-label":t?i:void 0,href:e.id,key:e.id,...n},t||i)}))},t1={delimiter:", "},t2=(0,c.createContext)(void 0),t3=()=>{let e=(0,c.useContext)(t2);if(void 0===e)throw Error("usePrimitivesContext must be used with a PrimitivesProvider");return e},t4=({children:e,initialState:t=t1})=>{let i=t5(t,"delimiter");return c.createElement(t2.Provider,{value:{delimiter:i}},e)},t5=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,t6=tl("span",{}),t8=e=>{let{as:t,markup:i}=e,{delimiter:n}=t3();if(!i)return c.createElement(c.Fragment,null);let r=tQ(e,["as","markup"]),a={__html:E(tU(i,r.lang,n),{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})};return c.createElement(t6,{as:t,...r,dangerouslySetInnerHTML:a})},t7=e=>c.useContext(t2)?c.createElement(t8,{...e}):c.createElement(t4,null,c.createElement(t8,{...e})),t9=({as:e="dd",lang:t,value:i})=>c.createElement(t7,{markup:i,as:e,lang:t}),ie=tl("span",{}),it=({as:e="dd",customValueContent:t,lang:i,value:n})=>{var r;let{delimiter:a}=t3(),o=null==(r=tq(n,i))?void 0:r.map(e=>(0,c.cloneElement)(t,{value:e}));return c.createElement(ie,{as:e,lang:i},null==o?void 0:o.map((e,t)=>[t>0&&`${a}`,c.createElement(c.Fragment,{key:t},e)]))},ii=e=>{var t;let{item:i,lang:n,customValueContent:r}=e,{label:a,value:o}=i,l=null==(t=tU(a))?void 0:t.replace(" ","-").toLowerCase();return c.createElement("div",{role:"group","data-label":l},c.createElement(tJ,{as:"dt",label:a,lang:n}),r?c.createElement(it,{as:"dd",customValueContent:r,value:o,lang:n}):c.createElement(t9,{as:"dd",value:o,lang:n}))},ir=tl("dl",{}),ia=e=>{let{as:t,customValueContent:i,metadata:n}=e;if(!Array.isArray(n))return c.createElement(c.Fragment,null);let r=eY(e,"customValueDelimiter"),a=tQ(e,["as","customValueContent","customValueDelimiter","metadata"]);return c.createElement(t4,{..."string"==typeof r?{initialState:{delimiter:r}}:void 0},n.length>0&&c.createElement(ir,{as:t,...a},n.map((e,t)=>{let n=i?function(e,t){let i=t.filter(t=>{let{matchingLabel:i}=t,n=Object.keys(t.matchingLabel)[0],r=tU(i,n);if(tU(e,n)===r)return!0}).map(e=>e.Content);if(Array.isArray(i))return i[0]}(e.label,i):void 0;return c.createElement(ii,{customValueContent:n,item:e,key:t,lang:null==a?void 0:a.lang})})))};tl("li",{}),tl("ul",{});let io=tl("li",{}),il=tl("ul",{}),is=e=>{let{as:t,rendering:i}=e,n=tQ(e,["as","rendering"]);return c.createElement(il,{as:t},i&&i.map(e=>{let t=tU(e.label,n.lang);return c.createElement(io,{key:e.id},c.createElement("a",{href:e.id,...n,target:"_blank"},t||e.id))}))},ic=tl("dl",{}),id=e=>{let{as:t,requiredStatement:i}=e;if(!i)return c.createElement(c.Fragment,null);let n=eY(e,"customValueDelimiter"),r=tQ(e,["as","customValueDelimiter","requiredStatement"]);return c.createElement(t4,{..."string"==typeof n?{initialState:{delimiter:n}}:void 0},c.createElement(ic,{as:t,...r},c.createElement(ii,{item:i,lang:r.lang})))},iu=tl("li",{}),im=tl("ul",{}),ip=e=>{let{as:t,seeAlso:i}=e,n=tQ(e,["as","seeAlso"]);return c.createElement(im,{as:t},i&&i.map(e=>{let t=tU(e.label,n.lang);return c.createElement(iu,{key:e.id},c.createElement("a",{href:e.id,...n},t||e.id))}))},ih=e=>{let{as:t,summary:i}=e,n=tQ(e,["as","customValueDelimiter","summary"]);return c.createElement(t7,{as:t,markup:i,...n})},ig=e=>{let{thumbnail:t,region:i}=e,n=tQ(e,["thumbnail"]);return c.createElement(c.Fragment,null,t&&t.map(e=>c.createElement(tY,{contentResource:e,key:e.id,region:i,...n})))},iv=({annotationPage:e})=>{var t,i,n,r,a,o;let{vault:l}=e9();if(!e||!e.items||(null==(t=e.items)?void 0:t.length)===0)return c.createElement(c.Fragment,null);let s=e.items.map(e=>l.get(e.id));if(!s)return c.createElement(c.Fragment,null);let d=s.reduce((e,t)=>(e.canvas=t.target.source.id,e.annotations=[],e.annotations.push(null==t?void 0:t.id),e),{}),u=l.get(d.canvas),m=ta(l,u.id),p=null!=(i=null==m?void 0:m[0])&&i.service?(null==(r=null==(n=null==m?void 0:m[0])?void 0:n.service[0])?void 0:r.id)||(null==(o=null==(a=null==m?void 0:m[0])?void 0:a.service[0])?void 0:o["@id"]):void 0;return c.createElement(tI,{"data-testid":"annotation-page"},u&&c.createElement("header",null,c.createElement(tJ,{label:u.label})),c.createElement("div",{"data-testid":"annotation-page-items"},null==s?void 0:s.map(e=>c.createElement(tW,{annotation:e,targetResource:p,key:e.id}))))},iy=tl("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),ib=tl("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),ix=({searchServiceUrl:e,setContentSearchResource:t,setLoading:i})=>{let{t:n}=(0,s.Bd)(),[r,a]=(0,c.useState)(),{openSeadragonViewer:o,vault:l}=e9();async function d(n){if(n.preventDefault(),o&&e){if(!r||""===r.trim())return void t({});i(!0),ti(l,e,{q:r}).then(e=>{t(e),i(!1)})}}let u=n("contentSearchPlaceholder");return c.createElement(iy,null,c.createElement(C.bL,{onSubmit:d,className:"content-search-form"},c.createElement(C.D0,{className:"content-search-input",name:"searchTerms",onChange:e=>{e.preventDefault(),a(e.target.value)}},c.createElement(C.Ec,{placeholder:u})),c.createElement(C.XT,{asChild:!0},c.createElement(ib,{type:"submit"},c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},c.createElement("title",null,n("informationPanelTabsSearch")),c.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},iw=({searchServiceUrl:e,setContentSearchResource:t,activeCanvas:i,annotationPage:n})=>{let r,{vault:a}=e9(),{t:o}=(0,s.Bd)(),[l,d]=(0,c.useState)(!1),[u,m]=(0,c.useState)({});return(0,c.useEffect)(()=>{var e;null!=n&&n.items&&m((null==(e=null==n?void 0:n.items)?void 0:e.map(e=>a.get(e.id))).reduce((e,t)=>{let i=t.target.source.id;return e[i]||(e[i]=[]),e[i].push(t.id),e},{}))},[n]),c.createElement(c.Fragment,null,c.createElement(ix,{searchServiceUrl:e,setContentSearchResource:t,activeCanvas:i,setLoading:d}),l?c.createElement("span",null,o("contentSearchLoading")):u&&Object.keys(u).length>0&&Object.keys(u).map(e=>(r=a.get(e),c.createElement(tI,{key:e,"data-testid":"annotation-page"},r&&c.createElement("header",null,c.createElement(tJ,{label:r.label})),u[e].map(e=>{var t,i,n,o,l;let s=a.get(e),d=ta(a,r.id),u=null!=(t=null==d?void 0:d[0])&&t.service?(null==(n=null==(i=null==d?void 0:d[0])?void 0:i.service[0])?void 0:n.id)||(null==(l=null==(o=null==d?void 0:d[0])?void 0:o.service[0])?void 0:l["@id"]):void 0;return c.createElement(tW,{annotation:s,targetResource:u,key:s.id,isContentSearch:!0})})))))},iE=tl("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),iS=tl("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),iC=({homepage:e})=>(null==e?void 0:e.length)===0?c.createElement(c.Fragment,null):c.createElement(c.Fragment,null,c.createElement("span",{className:"manifest-property-title"},"Homepage"),c.createElement(t0,{homepage:e})),iA=({id:e,htmlLabel:t,parent:i="manifest"})=>c.createElement(c.Fragment,null,c.createElement("span",{className:"manifest-property-title"},t),c.createElement("a",{href:e,target:"_blank",id:`iiif-${i}-id`},e)),ik=({metadata:e,parent:t="manifest"})=>e?c.createElement(c.Fragment,null,c.createElement(ia,{metadata:e,id:`iiif-${t}-metadata`})):c.createElement(c.Fragment,null),iI=({rendering:e})=>(null==e?void 0:e.length)===0?c.createElement(c.Fragment,null):c.createElement(c.Fragment,null,c.createElement("span",{className:"manifest-property-title"},"Alternate formats"),c.createElement(is,{rendering:e})),iR=({requiredStatement:e,parent:t="manifest"})=>e?c.createElement(c.Fragment,null,c.createElement(id,{requiredStatement:e,id:`iiif-${t}-required-statement`})):c.createElement(c.Fragment,null),iT=({rights:e})=>e?c.createElement(c.Fragment,null,c.createElement("span",{className:"manifest-property-title"},"Rights"),c.createElement("a",{href:e,target:"_blank"},e)):c.createElement(c.Fragment,null),iO=({seeAlso:e})=>(null==e?void 0:e.length)===0?c.createElement(c.Fragment,null):c.createElement(c.Fragment,null,c.createElement("span",{className:"manifest-property-title"},"See Also"),c.createElement(ip,{seeAlso:e})),i$=({summary:e,parent:t="manifest"})=>e?c.createElement(c.Fragment,null,c.createElement(ih,{summary:e,as:"p",id:`iiif-${t}-summary`})):c.createElement(c.Fragment,null),iL=({label:e,thumbnail:t})=>(null==t?void 0:t.length)===0?c.createElement(c.Fragment,null):c.createElement(c.Fragment,null,c.createElement(ig,{altAsLabel:e||{none:["resource"]},thumbnail:t,style:{backgroundColor:"#6663",objectFit:"cover"}})),iM=()=>{let{activeManifest:e,vault:t}=e9(),[i,n]=(0,c.useState)(),[r,a]=(0,c.useState)([]),[o,l]=(0,c.useState)([]),[s,d]=(0,c.useState)([]),[u,m]=(0,c.useState)([]);return(0,c.useEffect)(()=>{var i,r,o,s;let c=t.get(e);c&&(n(c),(null==(i=c.homepage)?void 0:i.length)>0&&a(t.get(c.homepage)),(null==(r=c.seeAlso)?void 0:r.length)>0&&l(t.get(c.seeAlso)),(null==(o=c.rendering)?void 0:o.length)>0&&d(t.get(c.rendering)),(null==(s=c.thumbnail)?void 0:s.length)>0&&m(t.get(c.thumbnail)))},[e,t]),i?c.createElement(iS,null,c.createElement(iE,null,c.createElement(iL,{thumbnail:u,label:i.label}),c.createElement(i$,{summary:i.summary}),c.createElement(ik,{metadata:i.metadata}),c.createElement(iR,{requiredStatement:i.requiredStatement}),c.createElement(iT,{rights:i.rights}),c.createElement(iC,{homepage:r}),c.createElement(iO,{seeAlso:o}),c.createElement(iI,{rendering:s}),c.createElement(iA,{id:i.id,htmlLabel:"IIIF Manifest"}))):c.createElement(c.Fragment,null)},iP=({contentStateAnnotation:e})=>{var t,i,n,r,a,o;let{vault:l}=e9();if(!e)return c.createElement(c.Fragment,null);let s=(null==(t=null==e?void 0:e.target)?void 0:t.source)||(null==e?void 0:e.target),d=l.get(null==s?void 0:s.id),u=ta(l,d.id),m=null!=(i=null==u?void 0:u[0])&&i.service?(null==(r=null==(n=null==u?void 0:u[0])?void 0:n.service[0])?void 0:r.id)||(null==(o=null==(a=null==u?void 0:u[0])?void 0:a.service[0])?void 0:o["@id"]):void 0;return c.createElement(tI,{"data-testid":"annotation-page"},d&&c.createElement("header",null,c.createElement(tJ,{label:d.label})," ",c.createElement("em",null,"(Shared)")),c.createElement("div",{"data-testid":"annotation-page-items"},c.createElement(tW,{annotation:e,targetResource:m,key:e.id,isContentState:!0})))},iF=({activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:r})=>{var a;let{t:o}=(0,s.Bd)(),l=te(),{contentStateAnnotation:d,informationPanelResource:u,isAutoScrolling:m,isUserScrolling:p,vault:h,configOptions:f,plugins:v}=e9(),{informationPanel:y}=f,b=null==y?void 0:y.renderAbout,x=null==y?void 0:y.renderAnnotation,w=h.get({id:e,type:"Canvas"}),E=null==y?void 0:y.renderContentSearch,S=null==y?void 0:y.renderToggle,C=(null==(a=null==d?void 0:d.target)?void 0:a.source)||(null==d?void 0:d.target),A=!!d&&C.id===e,k=!!(null!=t&&t.length)||A,{pluginsWithInfoPanel:I}=function(e){let t=[];return e.forEach(e=>{var i;null!=(i=e.informationPanel)&&i.component&&t.push(e)}),{pluginsWithInfoPanel:t}}(v);return(0,c.useEffect)(()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(null==y?void 0:y.defaultTab))?l({type:"updateInformationPanelResource",informationPanelResource:null==y?void 0:y.defaultTab}):l(A?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[]),(0,c.useEffect)(()=>{k||l({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[k]),c.createElement(tx,{"data-testid":"information-panel",defaultValue:u,onValueChange:e=>{l({type:"updateInformationPanelResource",informationPanelResource:e})},orientation:"horizontal",value:u,className:"clover-viewer-information-panel"},c.createElement(tw,{"aria-label":o("informationPanelTabs"),"data-testid":"information-panel-list"},S&&c.createElement(tE,{value:"manifest-back","data-value":"manifest-back",onClick:()=>{l({type:"updateInformationOpen",isInformationOpen:!1})},as:"button"},o("informationPanelTabsClose")),b&&c.createElement(tE,{value:"manifest-about"},o("informationPanelTabsAbout")),E&&r&&c.createElement(tE,{value:"manifest-content-search"},o("informationPanelTabsSearch")),x&&k&&c.createElement(tE,{value:"manifest-annotations"},(null==y?void 0:y.annotationTabLabel)||o("informationPanelTabsAnnotations")),I&&I.map((e,t)=>{var i;return c.createElement(tE,{key:t,value:e.id},c.createElement(tJ,{label:null==(i=e.informationPanel)?void 0:i.label}))})),c.createElement(tC,{handleScroll:function(){if(!m){clearTimeout(p);let e=setTimeout(()=>{l({type:"updateUserScrolling",isUserScrolling:void 0})},1500);l({type:"updateUserScrolling",isUserScrolling:e})}}},b&&c.createElement(tS,{value:"manifest-about"},c.createElement(iM,null)),E&&r&&c.createElement(tS,{value:"manifest-content-search"},c.createElement(iw,{searchServiceUrl:i,setContentSearchResource:n,activeCanvas:e,annotationPage:r})),x&&t&&c.createElement(tS,{value:"manifest-annotations"},d&&A&&c.createElement(iP,{contentStateAnnotation:d}),t.map(e=>c.createElement(iv,{key:e.id,annotationPage:e}))),I&&I.map((e,t)=>(function(e,t){var i,n;let r=null==(i=null==e?void 0:e.informationPanel)?void 0:i.component;return void 0===r?c.createElement(c.Fragment,null):c.createElement(tS,{key:t,value:e.id},c.createElement(g.ErrorBoundary,{FallbackComponent:th},c.createElement(r,{...null==(n=null==e?void 0:e.informationPanel)?void 0:n.componentProps,canvas:w,useViewerDispatch:te,useViewerState:e9})))})(e,t))))},ij=tl("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),iz=e=>c.createElement(ij,{...e,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},e.children);iz.Title=({children:e})=>c.createElement("title",null,e),iz.Add=()=>c.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),iz.Audio=()=>c.createElement(c.Fragment,null,c.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),c.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),c.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),iz.Close=()=>c.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),iz.Download=()=>c.createElement(c.Fragment,null,c.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),c.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),iz.Image=()=>c.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),iz.Video=()=>c.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"});let i_=tc({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),iH=tc({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),iB=tl(A.i3,{fill:"$secondaryAlt"}),iD=tl(A.bm,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),iV=tl(A.UC,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:iH},'&[data-side="bottom"]':{animationName:i_},'&[data-align="end"]':{[`& ${iB}`]:{margin:"0 0.7rem"}}}),iN=tl(A.l9,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),iW=tl(A.bL,{boxSizing:"content-box"}),iq=({children:e})=>c.createElement(iW,null,e);iq.Trigger=e=>c.createElement(iN,{...e},e.children),iq.Content=e=>c.createElement(iV,{...e,sideOffset:5,collisionPadding:21},c.createElement(iB,null),c.createElement(iD,null,c.createElement(iz,{isSmall:!0},c.createElement(iz.Close,null))),e.children);let iU=tl("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${ij}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),iQ=tl("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),iG=tl("span",{display:"flex"}),iJ=tl("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),iZ=tl("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),iX=tl("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${iG}`]:{position:"absolute",right:"0",bottom:"0",[`& ${iU}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),iY=tl(w.q7,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),iK=tl(w.bL,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),i0=tl("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${iY}`]:{figcaption:{fontWeight:"700"},[`& ${iU}`]:{backgroundColor:"$accent"},[`& ${iQ}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${iQ}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${iQ}`]:{borderLeft:"unset"}}}},[`& ${iY}`]:{[`& ${iX}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${iX}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${iX}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${iU}`]:{display:"flex"}}}}),i1=tl("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),i2=tl("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),i3=tl("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),i4=tl("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),i5=tl("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${i1}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),i6=(e,t)=>{(0,c.useEffect)(()=>{function i(i){i.key===e&&t()}return window.addEventListener("keyup",i),()=>window.removeEventListener("keyup",i)},[])},i8=({title:e})=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},c.createElement("title",null,e),c.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),i7=({title:e})=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},c.createElement("title",null,e),c.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),i9=({title:e})=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},c.createElement("title",null,e),c.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),ne=({title:e})=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},c.createElement("title",null,e),c.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),nt=({handleCanvasToggle:e,handleFilter:t,activeIndex:i,canvasLength:n})=>{let[r,a]=(0,c.useState)(!1),[o,l]=(0,c.useState)(!1),[d,u]=(0,c.useState)(!1),{t:m}=(0,s.Bd)();return(0,c.useEffect)(()=>{u(0===i),i===n-1?l(!0):l(!1)},[i,n]),i6("Escape",()=>{a(!1),t("")}),c.createElement(i5,{isToggle:r,className:"clover-viewer-media-controls"},c.createElement(i1,null,r&&c.createElement(i2,{autoFocus:!0,onChange:e=>t(e.target.value),placeholder:m("commonSearchPlaceholder")}),!r&&c.createElement(i4,{className:"clover-viewer-media-navigation"},c.createElement(i3,{onClick:()=>e(-1),disabled:d,type:"button"},c.createElement(i8,{title:m("commonPrevious")})),c.createElement("span",null,i+1," ",c.createElement("em",null,"/")," ",n),c.createElement(i3,{onClick:()=>e(1),disabled:o,type:"button"},c.createElement(i7,{title:m("commonNext")}))),c.createElement(i3,{onClick:()=>{a(e=>!e),t("")},type:"button",className:"clover-viewer-media-search"},r?c.createElement(i9,{title:m("commonClose")}):c.createElement(ne,{title:m("commonSearch")}))))},ni=({children:e,rootMargin:t="100px",attributes:i={},isVisibleCallback:n=()=>{}})=>{let r=(0,c.useRef)(null),[a,o]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{let e=r.current;if(!e)return;let i=new IntersectionObserver(([e])=>{e.isIntersecting&&(n(!0),o(!0),i.disconnect())},{rootMargin:t});return i.observe(e),()=>i.disconnect()},[r]),c.createElement("div",{ref:r,...i},a?e:null)};var nn="http://library.stanford.edu/iiif/image-api/compliance.html#level0",nr="http://library.stanford.edu/iiif/image-api/compliance.html#level1",na="http://library.stanford.edu/iiif/image-api/compliance.html#level2",no="http://library.stanford.edu/iiif/image-api/conformance.html#level0",nl="http://library.stanford.edu/iiif/image-api/conformance.html#level1",ns="http://library.stanford.edu/iiif/image-api/conformance.html#level2",nc="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",nd="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",nu="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",nm="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",np="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",nh="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",nf="http://iiif.io/api/image/1/level0.json",ng="http://iiif.io/api/image/1/profiles/level0.json",nv="http://iiif.io/api/image/1/level1.json",ny="http://iiif.io/api/image/1/profiles/level1.json",nb="http://iiif.io/api/image/1/level2.json",nx="http://iiif.io/api/image/1/profiles/level2.json",nw="http://iiif.io/api/image/2/level0.json",nE="http://iiif.io/api/image/2/profiles/level0.json",nS="http://iiif.io/api/image/2/level1.json",nC="http://iiif.io/api/image/2/profiles/level1.json",nA="http://iiif.io/api/image/2/level2.json",nk="http://iiif.io/api/image/2/profiles/level2.json",nI="level0",nR="level1",nT="level2",nO="http://iiif.io/api/image/2/level0",n$="http://iiif.io/api/image/2/level1",nL="http://iiif.io/api/image/2/level2",nM=[nL,na,ns,nu,nh,nb,nx,nA,nk,nT],nP=[...nM,n$,nr,nl,nd,np,nv,ny,nS,nC,nR],nF=[nO,n$,nL,nn,nr,na,no,nl,ns,nc,nd,nu,nm,np,nh,nf,ng,nv,ny,nb,nx,nw,nE,nS,nC,nA,nk,nI,nR,nT],nj=[nO,nn,no,nc,nm,nf,ng,nw,nE,nI],nz={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},n_={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},nH={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]},nB=Object.defineProperty,nD=(e,t,i)=>t in e?nB(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,nV=(e,t,i)=>(nD(e,"symbol"!=typeof t?t+"":t,i),i);function nN(e){for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==nj.indexOf(t))return!0;return!1}function nW(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function nq(e){if(!e||!e.profile||!nW(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==nF.indexOf(t))return!0;return!1}function nU(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}function nQ(e,t){if(t&&t.profile){let i=t.profile;if(i){let t=Array.isArray(i)?i:[i];if(t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`))return!0;if(2===e){for(let e of t)if(nM.includes(e))return!0}if(1===e){for(let e of t)if(nP.includes(e))return!0}if(0===e){for(let e of t)if(nj.includes(e))return!0}}}return!1}function nG(e){return nq(e)?nQ(0,e)?0:nQ(1,e)?1:nQ(2,e)?2:null:null}function nJ(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,n=[];for(let e=0;e<i;e++)nq(t[e])&&n.push(t[e]);return n}function nZ(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,"");return -1!==t.indexOf("/")?t.split("/")[0]:t}function nX(e,t,i){let n=function(e){let t=function(e,t=""){let{path:i,scheme:n,server:r,prefix:a}=function(e,t=""){let i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw Error(`Invalid or unknown input ${e}`);let n=i[2],r=i[3],a=i[4];if("/"===a[0]&&(a=a.substring(1)),t.length>0){if("/"===t[0]&&(t=t.substring(1)),t!==a.substring(0,t.length))throw Error(`Path does not start with prefix (path: ${a}, prefix: ${t})`);a=a.substring(t.length)}return{scheme:n,server:r,path:a,prefix:t}}(e,t),o=i.split("/").reverse(),[l,s,c,d,...u]=o,m=u.reverse().filter(Boolean).join("/");if(1===o.length||""===l)return{type:"base",scheme:n,server:r,prefix:a,identifier:m};if("info.json"===l){let[,...e]=o;return{type:"info",scheme:n,server:r,prefix:a,identifier:e.reverse().filter(Boolean).join("/")}}if(typeof n>"u"||typeof r>"u"||typeof i>"u"||typeof d>"u"||typeof c>"u"||typeof s>"u"||typeof l>"u")throw Error("Invalid image service URL");let[p="",h=""]=l.split(".");return{type:"image",scheme:n,server:r,prefix:a,identifier:m,originalPath:i,region:function(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};let t=e.startsWith("pct:"),i=e.substr(4*!!t).split(",").map(e=>parseFloat(e));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}(d),size:function(e){let t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;let i=e.split(",").map(e=>e.trim());return i.length&&(""!==i[0]&&(t.width=parseInt(i[0],10)),""!==i[1]&&(t.height=parseInt(i[1],10))),t}(c),rotation:function(e){let t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw Error(`Invalid rotation ${e}`);return t}(s),quality:p,format:h}}(nU(e.id));if("info"!==t.type)throw Error("Invalid service URL");let i=function(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let e of t){var n;if("string"==typeof e&&(n=e,e=-1!==nM.indexOf(n)?nH:-1!==nP.indexOf(n)?n_:nz),e){if(e.formats)for(let t of e.formats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.qualities)for(let t of e.qualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.supports)for(let t of e.supports)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea),e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea)}}if(e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:nU(nW(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}`,type:3===e.version?"ImageService3":"ImageService2"});return n.size.max=!1,n.size.width=t,n.size.height=i,{id:function(e,t){let i=e.prefix.startsWith("/")?e.prefix.substring(1):e.prefix,n=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`,{size:r}=e,{region:a,rotation:o,format:l,quality:s}=e;return[n,function({x:e=0,y:t=0,w:i,h:n,full:r,square:a,percent:o}){return"full"}(a),function({max:e,percentScale:t,upscaled:i,confined:n,width:r,height:a,serialiseAsFull:o,version:l}){let s=[];return i&&s.push("^"),e?s.push(o?"full":"max"):(n&&s.push("!"),t&&s.push(`pct:${t}`),r&&s.push(`${r}`),s.push(","),a&&3===l&&s.push(`${a}`)),s.join("")}(r),`${o.mirror?"!":""}${(o.angle||0)%360}`,`${s}.${l}`].filter(Boolean).join("/")}(n),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function nY(e){return -1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function nK(e){let t=[],i=e.length;for(let n=0;n<i;n++){let i=e[n];if(!i)continue;let r=function(e){return nq(e)?(e&&e.sizes?e.sizes:[]).map(t=>({id:nW(e),type:"fixed-service",height:t.height,width:t.width,level:nG(e),version:nY(e)?3:2})):[]}(i);r.length&&t.push(...r);let a=function(e){if(!function(e){if(!nq(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t){if(-1!==nP.indexOf(t))return!0}else{let e=[...t.supports||[],...t.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];let t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],n=i.length;for(let t=0;t<n;t++){let n=i[t];if(n&&"string"!=typeof n&&(n.maxHeight||n.maxWidth))return[{id:nW(e),type:"variable",minWidth:0,minHeight:0,maxHeight:n.maxHeight||n.maxWidth,maxWidth:n.maxWidth||n.maxHeight,level:nG(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){let i=e.tiles.length;for(let n=0;n<i;n++){let i=e.tiles[n];i&&(i.height||i.width)&&t.push({id:nW(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:nG(e),version:nY(e)?3:2})}}return t}(i);a.length&&t.push(...a)}return t}function n0(e){let t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t&&t[4]&&t[5]){let i=t[1],n=parseInt(t[4],10),r=parseInt(t[5],10),a=t[7];if(("max"===i||"full"===i)&&n&&r&&a)return{type:"fixed",id:e,height:r,width:n}}return{type:"unknown",id:e}}function n1(e){if("string"==typeof e)return n0(e);let t=e["@type"]?e["@type"]:e.type?e.type:void 0;if("Image"!==t&&"sc:Image"!==t)return null;let i=nW(e);return i?i&&e.width&&e.height?{id:i,type:"fixed",width:e.width,height:e.height,unsafe:!0}:n0(i):null}var n2=class{constructor(e={}){eH(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),eH(this,"fetchingCount",0),eH(this,"imageServices",{}),eH(this,"knownImageServers",{}),this.config=Object.assign(this.config,e)}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){let n=nZ(nW(e)),r=nU(nW(e)),a=this.knownImageServers[n];return this.imageServices[r]=Object.assign(e,{real:!0}),a||!e.tiles||nN(e)?this.verify(e):(this.knownImageServers[n]={verifications:0,malformed:!1,root:n,preLoaded:i,sampledId:nW(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:function(e,t,i){let n=i.length,r=[];for(let t=0;t<n;t++){let n=i[t];if(!n)continue;let a=n.width;r.push(e/a)}return r}(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){let n=null==e?void 0:e.source,r=nZ(nW(e)),a=this.knownImageServers[r],o=nU(nW(e));return this.imageServices[o]?this.imageServices[o]||null:!(!this.config.approximateServices||!a||!a.result||!(null!=n&&n.height||e.height)||!(null!=n&&n.width||e.width)||!i&&(a.malformed||a.verifications<this.config.verificationsRequired)||e.source&&nN(e.source))?(this.imageServices[o]||(this.imageServices[o]={"@context":a.result.context,"@id":nW(e),id:nW(e),protocol:"http://iiif.io/api/image",tiles:(null==n?void 0:n.tiles)||function(e,t,i){let n=e>t?e:t,r=i.length,a=[];for(let e=0;e<r;e++){let t=i[e];if(!t||0===t.scaleFactors.length)continue;let r=t.scaleFactors[0];if(!r)continue;let o=n/r,l=[r];for(;o>=t.width;)r*=2,l.push(r),o/=2;a.push({...t,scaleFactors:l})}return a}(e.width,e.height,a.result.sampledTiles),sizes:(null==n?void 0:n.sizes)||function(e,t,i){let n=i.length,r=[];for(let a=0;a<n;a++){let n=i[a];n&&r.push({width:Math.floor(e/n),height:Math.floor(t/n)})}return r}(Math.round(e.width/a.result.resourceServiceRatio),Math.round(e.height/a.result.resourceServiceRatio),a.result.sizeRatios),profile:(null==n?void 0:n.profile)||a.result.sampledProfile,height:(null==n?void 0:n.height)||e.height,width:(null==n?void 0:n.width)||e.width,real:!1}),this.imageServices[o]||null):null}async getThumbnailFromResource(e,t,i=!0,n=[]){let r=e?await this.getImageCandidates(e,i):[];return function(e,t){let i=[],n=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),r=(e,t=0)=>n.explain?i.push(Array(t).fill(0).map(e=>"    ").join("")+e().trim()):void 0,a=[],o=[],l=null;r(()=>`Using configuration: ${JSON.stringify(n,null,2)}`);let s=(e,t)=>{if(r(()=>"Swapping choice",3),function(e,t,i){let n=e.width?e.width:e.maxWidth;return i.height<=e.maxHeight&&i.width<=e.maxWidth&&i.height>=e.minHeight&&i.width>=e.minWidth&&(!t||Math.abs(i.width-n)<Math.abs(t.width-n))}(n,t,e)){if(n.preferFixedSize&&e.unsafe){r(()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`,4),o.push(e);return}n.returnAllOptions&&t&&o.push(t),r(()=>`We found a new image that was the best size. (${e.id})`,4),l=e}else n.returnAllOptions&&o.push(e)};r(()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`);let c=t.length;for(let e=0;e<c;e++){let i=t[e]();r(()=>`Candidate group ${e}: ${JSON.stringify(i,null,2)}`,1);let o=i.length;r(()=>`Checking candidate list number ${e} and found ${o} potential ways of creating image(s)`,1);for(let e=0;e<o;e++){let t=i[e];r(()=>`-> Checking candidate ${e}`,1),"unknown"===t.type&&n.atAnyCost&&(r(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),a.push(t)),"fixed"===t.type&&(t.unsafe?(r(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),a.push(t)):(r(()=>"We've found a fixed size image, checking if it matches the request",2),s(t,l))),"fixed-service"===t.type&&(n.unsafeImageService?(r(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),s(nX(t,n.width,n.height),l)):(r(()=>"Checking for an image from the tile source 3",2),s(nX(t,t.width,t.height),l))),"variable"===t.type&&t.maxWidth&&s(nX({id:t.id,width:t.maxWidth,height:t.maxWidth,level:t.level,version:t.version},t.maxWidth),l)}if(l&&!n.returnAllOptions){if(l.unsafe||n.allowUnsafe)continue;r(()=>`We found a match in choice list number ${e}, no searching any more`);break}}return n.atAnyCost&&0===o.length?(r(()=>l?`We found an image! ${l.id} of type ${l.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:l||a[0]||null,fallback:a.slice(1),log:i}):n.returnAllOptions?(r(()=>"Returning all options that we have found"),{best:(n.atAnyCost?l||o[0]||a[0]:l||o[0])||null,fallback:[...o,...a],log:i}):(r(()=>"Returning the best image that we found, and a fallback"),{best:l||o[0]||null,fallback:l?o:o.slice(1),log:i})}(t,[()=>n,()=>r])}async getImageCandidates(e,t=!0){if(t&&e&&e.height&&e.width)for(let t of nJ(e)){let i={id:nW(t),width:t.width?t.width:e.width,height:t.height?t.height:e.height,source:t};await this.loadService(i)}return function(e,t=!0,i){let n=[],r=n1(e);if(null===r)return n;if(n.push(r),t&&e&&e.width&&e.height){let t=[];for(let n of nJ(e)){let r={id:nW(n),width:e.width,height:e.height};if(i.canLoadSync(r)){let n=i.loadServiceSync(r);n&&(n.height||(n.height=e.height),n.width||(n.width=e.width),t.push(...nK([n])))}}if(t.length)return n.push(...t),n}return e.service&&n.push(...nK(e.service)),n}(e,t,this)}async verify(e){let t=this.predict(e,!1,!0),i=await this.fetchService(nW(e));if(!t)return!1;let n=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;let i=e.length,n=!0;for(let r=0;r<i;r++){let i=e[r],a=t[r];if(i.width!==a.width||i.height!==a.height){n=!1;break}}if(n)return!0;let r=0;for(let n=0;n<i;n++)for(let a=0;a<i;a++)if(e[n].width===t[a].width&&e[n].height===t[a].height){r++;break}return r===i}(t.sizes||[],i.sizes||[]);if(n){let t=nZ(nW(e)),i=this.knownImageServers[t];i&&(i.verifications+=1,i.verifications>=this.config.verificationsRequired&&(i.verified=!0))}return n}canLoadSync(e){let t="string"==typeof e?e:nW(e),i=nU(t);if(this.imageServices[i])return!0;let n=this.knownImageServers[nZ(t)];return!!(n&&!n.malformed&&n.verifications>=this.config.verificationsRequired)}async markAsMalformed(e){return this.knownImageServers[nZ(nW(e))].malformed=!0,this.loadService(e,!0)}async fetchService(e,t=!1){let i=nU(e),n=this.imageServices[i];if(n&&(!t||n.real))return n;if(!this.config.enableFetching)throw Error("Fetching is not enabled");let r=await this.fetch(i).then(e=>e.json());return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==e&&(r.id=e,r["@id"]&&(r["@id"]=e)),this.imageServices[i]=Object.assign(r,{real:!0}),this.imageServices[i]}async fetch(e,t){return fetch(e,t)}async loadService(e,t=!1){if(!this.config.disableThrottling){let e=!0;for(;e;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(e=>setTimeout(e,500));else{e=!1;break}}let i=this.knownImageServers[nZ(nW(e))];if(i&&!i.malformed&&!t){await i.result;let t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;let n=await this.fetchService(nW(e),t);return this.fetchingCount--,n.real&&this.sample(n,e),n}loadServiceSync(e){let t=nU(nW(e));return this.imageServices[t]?this.imageServices[t]:this.config.approximateServices?this.predict(e):null}};!function(e={}){let t=e.events||ej(),i=e.loader||new n2;eE((e,n)=>({loaded:{},loadServiceSync:(r,a,o)=>{let l=r.id||r["@id"],s=n().loaded[l];if(s&&"done"===s.status)return s.service;if(s&&"loading"===s.status)return null;if(s&&"error"===s.status)throw Error("Failed to load image service");let c={id:nW(r),width:r.width||(null==a?void 0:a.width)||0,height:r.height||(null==a?void 0:a.height)||0,source:r},d=i.loadServiceSync(c);return d?(e(e=>({loaded:{...e.loaded,[l]:{status:"done",service:d,real:!0}}})),t.emit("image-service.loaded",{id:l,service:d})):o&&n().loadService(r,a).then(()=>{}),d},loadService:async(r,a)=>{let o=r.id||r["@id"],l=n().loaded[o];if(l&&"done"===l.status)return l.service;if(l&&"loading"===l.status)return new Promise((e,i)=>{let n=i=>{i.id===o&&(t.off("image-service.loaded",n),e(i.service||r))};t.on("image-service.loaded",n)});if(l&&"error"===l.status&&!(null!=a&&a.force))throw Error("Failed to load image service");t.emit("image-service.loading",{id:o});try{let n={id:nW(r),width:r.width||0,height:r.height||0,source:r},l=await i.loadService(n,null==a?void 0:a.force);return e(e=>({loaded:{...e.loaded,[o]:{status:"done",service:l,real:l.real}}})),t.emit("image-service.loaded",{id:o,service:l}),l}catch(e){throw t.emit("image-service.error",{id:o,error:e}),e}}}))}();var n3={},n4={get:e=>e,setMetaValue([e,t,i],n){let r=n4.getResourceMeta(e,t),a=r?r[i]:void 0,o="function"==typeof n?n(a):n;n3[e]={...n3[e]||{},[t]:{...(n3[e]||{})[t]||{},[i]:o}}},getResourceMeta:(e,t)=>{let i=n3[e];if(i)return t?i[t]:i},load:async e=>fetch("string"==typeof e?e:e.id).then(e=>e.json()),requestStatus(e){}},n5=new n2,n6=new Map;let n8=({type:e})=>{switch(e){case"Sound":return c.createElement(iz.Audio,null);case"Image":default:return c.createElement(iz.Image,null);case"Video":return c.createElement(iz.Video,null)}},n7=({canvas:e,canvasIndex:t,isActive:i,type:n,handleChange:r})=>{let[a,o]=(0,c.useState)(!1),[l,s]=(0,c.useState)(),{vault:d}=e9(),u=null!=e&&e.label?tU(null==e?void 0:e.label):String(t+1);return(0,c.useEffect)(()=>{a&&(async()=>{var t,i;try{if((null==(t=null==e?void 0:e.thumbnail)?void 0:t.length)!==0)s(null==(i=null==e?void 0:e.thumbnail[0])?void 0:i.id);else{let{best:t}=await function(e,{vault:t=n4,dereference:i=!1,...n}={}){let r=n6.get(t);return r||(r=function(e=n4,t={}){let i=t.imageServiceLoader||n5;async function n(t,r,a=!1,o=[],l){let s=()=>i.getThumbnailFromResource(void 0,r,a,o);if(!t)return await i.getThumbnailFromResource(void 0,r,a,o);if("string"==typeof t){let e=n1(t);return e&&o.push(e),await i.getThumbnailFromResource(void 0,r,a,o)}let c=e.get(t,{skipSelfReturn:!1});if("string"==typeof c)return{best:n1(c),fallback:[],log:[]};if(!c)return await s();switch(await (async t=>{if(t&&t.thumbnail&&t.thumbnail.length){let n=e.get(t.thumbnail[0]),r=await i.getImageCandidates(n,a);r&&r.length&&o.push(...r)}})(c),c.type){case"Annotation":{let t=Array.isArray(c.body)?c.body:[c.body],n=e.get(t[0]);return l&&!n.width&&(n.width=l.width,n.height=l.height),await i.getThumbnailFromResource(n,r,a,o)}case"Canvas":return n(c.items[0],r,a,o,{width:c.width,height:c.height});case"AnnotationPage":return n(c.items[0],r,a,o,l);case"Choice":return!c.items||c.items[0]?await s():n(c.items[0],r,a,o,l);case"Collection":{let e=c.items[0];return e?n(e,r,a,o,l):await s()}case"Manifest":{let e=c.items[0];return e?n(e,r,a,o,l):await s()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return l&&!c.width&&(c.width=l.width,c.height=l.height),i.getThumbnailFromResource(c,r,a,o)}return await s()}return{getBestThumbnailAtSize:n}}(t),n6.set(t,r)),r.getBestThumbnailAtSize(e,n,i)}(e,{vault:d,dereference:!0,width:200,height:200});s(null==t?void 0:t.id)}}catch(e){console.error("Error fetching thumbnail",e)}})()},[e,a]),c.createElement(iY,{"aria-checked":i,"data-testid":"media-thumbnail","data-canvas":t,onClick:()=>r(e.id),value:e.id},c.createElement("figure",null,c.createElement(iX,null,c.createElement(ni,{isVisibleCallback:e=>{o(e)},attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(a),"data-testid":"media-thumbnail-lazyload"}},l&&c.createElement("img",{alt:u,"data-testid":"media-thumbnail-image",src:l})),c.createElement(iQ,null),c.createElement(iG,null,c.createElement(iU,{isIcon:!0,"data-testid":"thumbnail-tag"},c.createElement(iJ,null),c.createElement(iz,{"aria-label":n},c.createElement(n8,{type:n})),["Video","Sound"].includes(n)&&c.createElement(iZ,null,eJ(e.duration))))),c.createElement("figcaption",{"data-testid":"fig-caption"},e.label?c.createElement(tJ,{label:e.label}):(t+1).toString())))},n9=e=>e.body?e.body.type:"Image",re=({items:e})=>{let{t}=(0,s.Bd)(),i=te(),{activeCanvas:n,vault:r,sequence:a}=e9(),[o,l]=(0,c.useState)(""),[d,u]=(0,c.useState)([]),[m,p]=(0,c.useState)(0),h=c.useRef(null),f=e=>{n!==e&&i({type:"updateActiveCanvas",canvasId:e})};return(0,c.useEffect)(()=>{if(!d.length){let t=["Image","Sound","Video"];u(e.map(e=>tn(r,e,"painting",t)).filter(e=>e.annotations.length>0))}},[e,d.length,r]),(0,c.useEffect)(()=>{d.forEach((e,t)=>{null!=e&&e.canvas&&e.canvas.id===n&&p(t)})},[n,d]),(0,c.useEffect)(()=>{let e=document.querySelector(`[data-canvas="${m}"]`);if(e instanceof HTMLElement&&h.current){let t=e.offsetLeft-h.current.offsetWidth/2+e.offsetWidth/2;h.current.scrollTo({left:t,behavior:"smooth"})}},[m]),c.createElement(c.Fragment,null,c.createElement(nt,{handleFilter:e=>l(e),handleCanvasToggle:e=>{let t=a[1].findIndex(e=>e.includes(m)),i=t+e>=0?t+e:a[1].length-1;if(!a[1][i])return;let n=a[1][i][0],r=a[0][n].id;r&&f(r)},activeIndex:m,canvasLength:e.length}),c.createElement(iK,{"aria-label":t("media.selectItem"),"data-testid":"media","data-active-canvas":e[m].id,"data-canvas-length":e.length,"data-filter":o,ref:h},a[1].filter(e=>e.some(e=>{var t;let i=a[0][e].id,n=d.find(e=>{var t;return(null==(t=null==e?void 0:e.canvas)?void 0:t.id)===i});if(!n)return!1;let r=tU(null==(t=null==n?void 0:n.canvas)?void 0:t.label)||"";return!(o&&!r.toLowerCase().includes(o.toLowerCase()))})).map((e,t)=>{let i=e.map(e=>a[0][e].id).includes(n);return c.createElement(i0,{"data-active":i,key:t},e.map(e=>{var t,i;let r=a[0][e].id,o=d.find(e=>{var t;return(null==(t=null==e?void 0:e.canvas)?void 0:t.id)===r});return o?c.createElement(n7,{canvas:o.canvas,canvasIndex:d.findIndex(e=>e===o),handleChange:f,isActive:n===(null==(t=null==o?void 0:o.canvas)?void 0:t.id),key:null==(i=null==o?void 0:o.canvas)?void 0:i.id,type:n9(o.annotations[0])}):null}))})))},rt=tl("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),ri=tl("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),rn=tl(ri,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),rr=tl("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${rn}`]:{backgroundColor:"$accent"},[`${rt}`]:{backgroundColor:"#6662"}}}),ra=tl("div",{width:"100%",height:"100%"}),ro=tl("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),rl=tl(k.l9,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),rs=tl(k.UC,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),rc=tl(k.q7,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),rd=tl(k.JU,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),ru=tl(k.bL,{position:"relative",zIndex:"5",width:"100%"}),rm=({direction:e,title:t})=>c.createElement(ro,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},c.createElement("title",null,t),"up"===e&&c.createElement(()=>c.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),"down"===e&&c.createElement(()=>c.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),rp=({children:e,label:t,maxHeight:i,onValueChange:n,value:r})=>c.createElement(ru,{onValueChange:n,value:r},c.createElement(rl,{"data-testid":"select-button"},c.createElement(k.yv,{"data-testid":"select-button-value"}),c.createElement(k.wB,null,c.createElement(rm,{direction:"down",title:"select"}))),c.createElement(k.Vp,null,c.createElement(rs,{css:{maxHeight:`${i} !important`},"data-testid":"select-content"},c.createElement(k.p8,null,c.createElement(rm,{direction:"up",title:"scroll up for more"})),c.createElement(k.H,null,c.createElement(k.s3,null,t&&c.createElement(rd,null,c.createElement(tJ,{"data-testid":"select-label",label:t})),e)),c.createElement(k.y2,null,c.createElement(rm,{direction:"down",title:"scroll down for more"}))))),rh=e=>c.createElement(rc,{...e},e.thumbnail&&c.createElement(ig,{thumbnail:e.thumbnail}),c.createElement(k.h,null,c.createElement(tJ,{label:e.label})),c.createElement(k.h3,null)),rf=window.OpenSeadragon;if(!rf&&!(rf=I))throw Error("OpenSeadragon is missing.");let rg="http://www.w3.org/2000/svg";rf.Viewer&&(rf.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new rv(this)),this._svgOverlayInfo});let rv=function(e){let t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(rg,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(rg,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){t.resize()}),this._viewer.addHandler("open",function(){t.resize()}),this._viewer.addHandler("rotate",function(){t.resize()}),this._viewer.addHandler("flip",function(){t.resize()}),this._viewer.addHandler("resize",function(){t.resize()}),this.resize()};function ry(e){for(let t in e)(typeof e[t]>"u"||null===e[t])&&delete e[t];return e}rv.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));let e=this._viewer.viewport.pixelFromPoint(new rf.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),i=this._viewer.viewport.getRotation(),n=this._viewer.viewport.getFlip(),r=this._viewer.viewport._containerInnerSize.x,a=r*t,o=a;n&&(a=-a,e.x=-e.x+r),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+a+","+o+") rotate("+i+")")},onClick:function(e,t){new rf.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};var rb=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"],rx=class e{constructor(e,t={}){nV(this,"traversals"),nV(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(t){return new e({collection:[t],manifest:[t],canvas:[t],annotationList:[t],sequence:[t],annotation:[t],contentResource:[t],choice:[t],range:[t],service:[t],layer:[t]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let t=[...(e.manifests||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e),...(e.collections||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e),...e.members||[]],i=[],n=t.filter(e=>!i.includes(e["@id"])&&(i.push(e["@id"]),!0));delete e.collections,delete e.manifests,e.members=n}return e.manifests&&(e.manifests=e.manifests.map(e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e))),e.collections&&(e.collections=e.collections.map(e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e))),e.members&&(e.members=e.members.map(e=>"string"==typeof e?e:"sc:Collection"===e["@type"]?this.traverseCollection(e):"sc:Manifest"===e["@type"]?this.traverseManifest(e):this.traverseUnknown(e))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(e=>this.traverseSequence(e))),e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(e=>this.traverseCanvas(e))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(e=>this.traverseAnnotation(e))),e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e),...(e.canvases||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(e=>this.traverseUnknown(e)):void 0}return e}traverseAnnotationList(e){return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems("string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(e=>this.traverseAnnotation(e))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(e=>this.traverseContentResource(e)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map(e=>this.traverseContentResource(e))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(typeof e>"u"||null===e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e)throw Error(`${typeof e} is not a valid entity`);if("string"==typeof e["@type"]){let t=rb.indexOf(e["@type"]);if(-1!==t)return rb[t]}if(e.profile)return"Service";if(e.format||e["@type"])return"ContentResource";throw Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],n=[];for(let e of i)"string"==typeof e?n.push(this.traverseContentResource({"@id":e,"@type":"dctypes:Image"})):n.push(this.traverseContentResource(e));return t||this.options.convertPropsToArray?n:n[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],n=[];for(let e of i)n.push(this.traverseService(e));return t||this.options.convertPropsToArray?n:n[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e))if(!this.options.convertPropsToArray)return this.traverseType(e,t);else e=[e];return e.map(e=>this.traverseType(e,t))}traverseType(e,t){return t.reduce((e,t)=>{let i=t(e);return typeof i>"u"&&!this.options.allowUndefinedReturn?e:i},e)}},rw=["http://iiif.io/api/image/2/level1","http://iiif.io/api/image/2/level2","http://library.stanford.edu/iiif/image-api/compliance.html#level1","http://library.stanford.edu/iiif/image-api/compliance.html#level2","http://library.stanford.edu/iiif/image-api/conformance.html#level1","http://library.stanford.edu/iiif/image-api/conformance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1","http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2","http://iiif.io/api/image/1/level1.json","http://iiif.io/api/image/1/profiles/level1.json","http://iiif.io/api/image/1/level2.json","http://iiif.io/api/image/1/profiles/level2.json","http://iiif.io/api/image/2/level1.json","http://iiif.io/api/image/2/profiles/level1.json","http://iiif.io/api/image/2/level2.json","http://iiif.io/api/image/2/profiles/level2.json","level1","level2"],rE={attributionLabel:"Attribution",providerId:"http://example.org/provider",providerName:""};function rS(e,t="none"){if(!e)return{none:[""]};let i=function(e){if("string"==typeof e)return[e];if(!e)return[];let t=Array.isArray(e)?e:[e],i=[];for(let e of t){if("string"==typeof e){i.push(e);continue}i.push({"@language":e["@language"]||e.language,"@value":e["@value"]||e.value})}return i}(e),n={};for(let e of i){if("string"==typeof e){n[t]=n[t]?n[t]:[],n[t].push(e||"");continue}if(!e["@language"]){n[t]=n[t]?n[t]:[],n[t].push(e["@value"]||"");continue}let i=e["@language"];n[i]=n[i]?n[i]:[],n[i].push(e["@value"]||"")}return 0===Object.keys(n).length?{none:[""]}:n}function rC(e){for(let t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}var rA=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function rk(e){let t=e["@id"]||e.id,i=e["@type"]||e.type,n=e.profile||void 0,r=e["@context"]||void 0;if(n){let e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(n);if(e)return e}if(r){let e=function(e){for(let t of Array.isArray(e)?e:[e])switch(t){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(r);if(e)return e}if(i){if(Array.isArray(i)){if(-1!==i.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==i.indexOf("cnt:ContentAsText"))return"TextualBody";i=i[0]}for(let e of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${e}:`)){i=i.slice(e.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&-1!==rA.indexOf(i))return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/")||"application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}var rI=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm,rR=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"],rT=0;function rO(e,t){let i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(rT++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${rT}`)}function r$(e){let t,i=[...e.behavior||[]];return e.viewingHint&&i.push(e.viewingHint),Array.isArray(e.motivation)?t=e.motivation.map(rC):e.motivation&&(t=rC(e.motivation)),{"@context":e["@context"]?function(e){if(e){let t=Array.isArray(e)?e:[e],i=[];for(let e of t)"http://iiif.io/api/presentation/2/context.json"===e&&i.push("http://iiif.io/api/presentation/3/context.json"),-1===rR.indexOf(e)&&i.push(e);if(t.length)return 1===i.length?i[0]:i}}(e["@context"]):void 0,id:(e["@id"]||rO(e)).trim(),type:rk(e),behavior:i.length?i:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:t,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function rL(e){var t,i;let[n,r]=function(e,t="Rights/License",i="none"){let n=null,r=[];for(let a of Array.isArray(e)?e:[e]){let e=a?function(e){let t=e.match(rI);return t?t[0]:e}(a):void 0;if(e&&(-1!==e.indexOf("creativecommons.org")||-1!==e.indexOf("rightsstatements.org"))){n=e.startsWith("https://")?`http://${e.slice(8)}`:e;continue}e&&r.push({label:{[i]:[t]},value:{[i]:[e]}})}return[n,r]}(e.license),a=[...e.metadata&&(t=e.metadata)?t.map(e=>({label:rS(e.label),value:rS(e.value)})):[],...r];return{rights:n,metadata:a.length?a:void 0,label:e.label?rS(e.label):void 0,requiredStatement:e.attribution?{label:rS(rE.attributionLabel),value:rS(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?rS(e.description):void 0,thumbnail:(i=e.thumbnail)&&(Array.isArray(i)?i:[i]).map(e=>"string"==typeof e?{id:e,type:"Image"}:("unknown"===e.type&&(e.type="Image"),e))}}function rM(e){var t;let i=e.related?Array.isArray(e.related)?e.related:[e.related]:[],n=e.contentLayer;return{provider:e.logo||i.length?[{id:rE.providerId,type:"Agent",homepage:i.length?[i[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:rS(rE.providerName)}]:void 0,partOf:function(e){if(!e.within)return;let t=Array.isArray(e.within)?e.within:[e.within],i=[];for(let n of t)"string"==typeof n?n&&"sc:Manifest"===e["@type"]&&i.push({id:n,type:"Collection"}):n["@id"]&&i.push({id:n["@id"],type:rk(n)});return i.length?i:void 0}(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?Array.isArray(t=e.service)?t:t?[t]:[]:void 0,supplementary:n?[n]:void 0}}function rP(e,t){return e?"string"==typeof e?{id:e,type:t}:"string"==typeof(null==e?void 0:e["@id"])?{id:e["@id"],type:t}:"string"==typeof e.id?{id:e.id,type:t}:null:null}function rF(e){return"Choice"===e.type?e:rj(e)}function rj(e){return ry({...r$(e),...rL(e),...rM(e),...{chars:e.chars,format:e.format?e.format:void 0,language:e.language}})}var rz=new rx({collection:[function(e){return ry({...r$(e),...rL(e),...rM(e),...function(e){let t={};if(e.first){let i=rP(e.first,"Collection");i&&(t.first=i)}if((e.total||0===e.total)&&(t.total=e.total),e.prev){let i=rP(e.prev,"Collection");i&&(t.prev=i)}if(e.next){let i=rP(e.next,"Collection");i&&(t.next=i)}return t}(e),items:function(e){let t=[];for(let i of e){let e={...i};e.items&&0===e.items.length&&delete e.items,t.push(e)}return t}(e.members)})}],manifest:[function(e){let t=[],i=[],n,r;for(let a of e.sequences||[])a.canvases.length&&t.push(...a.canvases),a.behavior&&i.push(...a.behavior),a.viewingDirection&&(r=a.viewingDirection),a.startCanvas&&(n=a.startCanvas);let a=r$(e);return i.length&&(a.behavior?a.behavior.push(...i):a.behavior=i),ry({...a,...rL(e),...rM(e),viewingDirection:r,start:n,items:t,structures:function(e){if(!e)return e;let t=new Map;for(let i of e)t.set(i.id,i);let i=[];for(let n of e)if(n.items){let e=n.items.map(e=>"string"==typeof e?(i.push(e),t.get(e)||e):e&&e.id?(i.push(e.id),t.get(e.id)||e):e);n.items=e}return e.filter(e=>-1===i.indexOf(e.id))}(e.structures)})}],canvas:[function(e){return ry({...r$(e),...rL(e),...rM(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:rO(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return ry({...r$(e),...rL(e),...rM(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[],viewingDirection:e.viewingDirection,startCanvas:e.startCanvas}:{canvases:[],behavior:[]}}],annotation:[function(e){return ry({...r$(e),...rL(e),...rM(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if(!("@type"in t))return encodeURI(t["@id"]).trim();{let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else if("sc:Canvas"===t.full["@type"])e={id:t.full["@id"],type:"Canvas"};else throw Error(`Unsupported source type on annotation: ${t.full["@type"]}`);return{type:"SpecificResource",source:e,selector:function e(t){if((Array.isArray(t["@type"])&&t["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==t["@type"])&&("chars"in t||"value"in t))return{type:"SvgSelector",value:"chars"in t?t.chars:t.value};if("oa:FragmentSelector"===t["@type"])return{type:"FragmentSelector",value:t.value};if("oa:Choice"===t["@type"])return[e(t.default),...(Array.isArray(t.item)?t.item:[t.item]).map(e)];if("iiif:ImageApiSelector"==t["@type"])return{type:"ImageApiSelector",region:"region"in t?t.region:void 0,rotation:"rotation"in t?t.rotation:void 0};throw Error(`Unsupported selector type: ${t["@type"]}`)}(t.selector)}}}(e.on),body:Array.isArray(e.resource)?e.resource.map(rF):rF(e.resource)})}],contentResource:[rj],choice:[function(e){let t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),ry({...r$(e),...rL(e),items:t})}],range:[function(e){return ry({...r$(e),...rL(e),...rM(e),items:e.members})}],service:[function(e){let{"@id":t,"@type":i,"@context":n,profile:r,...a}=e,o={};return t&&(o["@id"]=t),o["@type"]=rk(e),"unknown"===o["@type"]&&(n&&n.length&&(o["@context"]=n),o["@type"]="Service"),r&&(o.profile=function e(t){return Array.isArray(t)?e(t.find(e=>"string"==typeof e)):-1!==nM.indexOf(t)?"level2":-1!==rw.indexOf(t)?"level1":-1!==nF.indexOf(t)?"level0":"string"==typeof t?t:void 0}(r)),ry({...o,...a})}],layer:[function(e){return ry({...r$(e),...rL(e),...rM(e)})}]});let r_=e=>(Array.isArray(e["@context"])?e["@context"]:[e["@context"]]).map(e=>null==e?void 0:e.replace("http://","https://")),rH=e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)}),rB=e=>{let t,i;if(Array.isArray(e)&&(t=e[0])){let e;i="@id"in t?t["@id"]:t.id}return i},rD=e=>{var t,i,n,r,a,o,l,s,c,d,u,m,p,h,f;let g,v={};switch(null==e?void 0:e.type){case"SpecificResource":v={manifest:g=null==(n=null==(i=null==(t=null==e?void 0:e.target)?void 0:t.partOf)?void 0:i[0])?void 0:n.id,canvas:null==(r=null==e?void 0:e.target)?void 0:r.id},null!=e&&e.selector&&(v.selector=e.selector);break;case"Range":case"Annotation":let y=(null==(a=null==e?void 0:e.target)?void 0:a.source)||(null==e?void 0:e.target),b=null==(o=null==e?void 0:e.target)?void 0:o.selector;v={manifest:null==(s=null==(l=null==y?void 0:y.partOf)?void 0:l[0])?void 0:s.id,canvas:null==y?void 0:y.id},((null==(c=null==e?void 0:e.target)?void 0:c.type)==="SpecificResource"||null!=(d=null==e?void 0:e.target)&&d.selector)&&(v.selector=b);break;case"Canvas":if(v={manifest:g=null==(m=null==(u=null==e?void 0:e.partOf)?void 0:u[0])?void 0:m.id,canvas:null==e?void 0:e.id},null!=(p=null==e?void 0:e.id)&&p.includes("#xywh=")){let[t,i]=e.id.split("#xywh=");v.canvas=t,v.selector={type:"FragmentSelector",value:`xywh=${i}`}}break;case"Manifest":g=null==e?void 0:e.id,v={collection:null==(f=null==(h=null==e?void 0:e.partOf)?void 0:h[0])?void 0:f.id,manifest:null==e?void 0:e.id};break;case"Collection":v={collection:g=null==e?void 0:e.id}}return{resourceId:g,active:v}},rV=e=>{let t=["https://iiif.io/api/presentation/2/context.json","https://iiif.io/api/presentation/3/context.json"],i=TypeError(`The IIIF content may not be a valid IIIF resource: ${t.join(", ")}`);e["@context"]||console.warn(i);let n=r_(e);try{if(n.includes(t[0])){let t=function(e){return e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]||e["@id"]&&"sc:Collection"===e["@type"]||e["@id"]&&"sc:Manifest"===e["@type"]?(e["@context"]||(e["@context"]="http://iiif.io/api/presentation/2/context.json"),rz.traverseUnknown(e)):e}(e);if(!t||!t.id||!t.type)throw i;return t}if(n.includes(t[1]))return e;throw i}catch(e){console.warn(e)}},rN=e=>{if("string"==typeof e&&rQ(e))return{resourceId:e};if("object"==typeof e){let t=rV(e);return{resourceId:null==t?void 0:t.id,resourceObject:t}}{let t=JSON.parse((0,p.B6)(e)),{active:i}=rD(t);return{active:i,resourceId:null==t?void 0:t.resourceId,resourceObject:t}}},rW=e=>{let{resourceId:t,resourceObject:i}=rN(e);return i||t},rq=e=>e.items.map(e=>e.id)[0],rU=e=>{let t=e.items.filter(e=>"Manifest"===e.type).map(e=>e.id);return 0==t.length?null:t[0]},rQ=e=>{try{new URL(e)}catch{return!1}return!0};var rG=(e=>(e.TiledImage="tiledImage",e.SimpleImage="simpleImage",e))(rG||{});let rJ=e=>{let t=Array.isArray(null==e?void 0:e.service)&&(null==e?void 0:e.service.length)>0;return{uri:t?rB(null==e?void 0:e.service):null==e?void 0:e.id,imageType:t?rG.TiledImage:rG.SimpleImage}},rZ=(e,t)=>({uri:e,imageType:t?rG.TiledImage:rG.SimpleImage}),rX=tl("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),rY=tl("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),rK=tl("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${rX}`]:{display:"block"}},false:{[`${rX}`]:{display:"none"}}}}}),r0=({className:e,id:t,label:i,children:n})=>{let r=i.toLowerCase().replace(/\s/g,"-");return c.createElement(ri,{id:t,className:e,"data-testid":"openseadragon-button","data-button":r},c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},c.createElement("title",{id:`${t}-svg-title`},i),n))},r1=tl("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),r2=()=>c.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),r3=()=>c.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),r4=()=>c.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),r5=()=>c.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),r6=()=>c.createElement(c.Fragment,null,c.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),c.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),r8=({_cloverViewerHasPlaceholder:e,config:t})=>{let{activeCanvas:i,plugins:n,vault:r,openSeadragonViewer:a}=e9(),o=r.get({id:i,type:"Canvas"});return(0,c.useEffect)(()=>{if(!a)return;let e=a.viewport.getRotation();a.addHandler("home",()=>{a.viewport.setRotation(e)})},[a]),c.createElement(r1,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:e},t.showZoomControl&&c.createElement(c.Fragment,null,c.createElement(r0,{id:t.zoomInButton,label:"zoom in"},c.createElement(r2,null)),c.createElement(r0,{id:t.zoomOutButton,label:"zoom out"},c.createElement(r3,null))),t.showFullPageControl&&c.createElement(r0,{id:t.fullPageButton,label:"full page"},c.createElement(r4,null)),t.showRotationControl&&c.createElement(c.Fragment,null,c.createElement(r0,{id:t.rotateRightButton,label:"rotate right"},c.createElement(r6,null)),c.createElement(r0,{id:t.rotateLeftButton,label:"rotate left"},c.createElement(r6,null))),t.showHomeControl&&c.createElement(r0,{id:t.homeButton,label:"reset"},c.createElement(r5,null)),n.filter(e=>{var t;return null==(t=e.imageViewer)?void 0:t.controls}).map((e,t)=>{var i,n,r,a;let l=null==(n=null==(i=e.imageViewer)?void 0:i.controls)?void 0:n.component;return c.createElement(l,{key:t,...null==(a=null==(r=null==e?void 0:e.imageViewer)?void 0:r.controls)?void 0:a.componentProps,canvas:o,useViewerDispatch:te,useViewerState:e9})}))};async function r7(e,t=3,i=500){try{return await e()}catch(n){if(t<=0)throw n;return await new Promise(e=>setTimeout(e,i)),r7(e,t-1,i)}}let r9=e=>new Promise(t=>setTimeout(t,e)),ae=async(e,t,i=3,n=300)=>{for(let r=0;r<i;r++){let i=t?t-1:0,r=e.getItemAt(i);if(r)return r;await r9(n)}throw Error("No base item found at index 0 after retries")},at=({annotations:e,ariaLabel:t,config:i,uri:n,_cloverViewerHasPlaceholder:r,imageType:a,openSeadragonCallback:o})=>{let[l,s]=(0,c.useState)([]),[d,u]=(0,c.useState)([]),[m,p]=(0,c.useState)(),[h,f]=(0,c.useState)([]),g=te(),v=(0,c.useRef)(!1),y=!1===i.gestureSettingsMouse.scrollToZoom;function b(){m&&(null==o||o(m))}return(0,c.useEffect)(()=>(v.current||(v.current=!0,m||p(I(i))),()=>null==m?void 0:m.destroy()),[]),(0,c.useEffect)(()=>{b()},[m,o]),(0,c.useEffect)(()=>{m&&JSON.stringify(n)!==JSON.stringify(d)&&(m.forceRedraw(),y&&m.addHandler("canvas-scroll",function(e){e.preventDefault=!1}),u(n))},[y,m,d,n]),(0,c.useEffect)(()=>{d.length&&m&&(m.close(),(async()=>{switch(a){case"simpleImage":let t=1,i=0;for(let n=0;n<d.length;n++){let r=d[n];if(e){let e=new Image;e.src=r,await e.decode(),f(t=>[...t,{width:null==e?void 0:e.width,height:null==e?void 0:e.height}])}try{if(0!==n){let e=(await ae(m.world,n)).getBounds();i=e.x+e.width,t=e.height}m.addSimpleImage({url:r,x:i,y:0,height:t,success:()=>{s(e=>[...e,r]),"function"==typeof g&&g({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(e){console.error(`Failed to load image at ${r}:`,e)}}break;case"tiledImage":{let e=1,t=0;for(let i=0;i<d.length;i++){let n=d[i];try{let r=await r7(()=>rH(n),3,1e3);if(!r)throw Error(`No tile source for ${n}`);if(0!==i){let n=(await ae(m.world,i)).getBounds();t=n.x+n.width,e=n.height}m.addTiledImage({tileSource:r,x:t,y:0,height:e,success:()=>{s(e=>[...e,n]),"function"==typeof g&&g({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(e){console.error(`Failed to load tile at ${n}:`,e)}}break}default:console.warn(`Unsupported imageType: "${a}"`)}})().catch(e=>console.error("Error drawing tiles",e)))},[d,a,m]),(0,c.useEffect)(()=>{if(l){let e=0,t=()=>{if(e<3){let i=null==m?void 0:m.world.getHomeBounds();i&&(null==m||m.viewport.fitBounds(i,!0)),e++,setTimeout(t,50)}};t(),null==m||m.addHandler("canvas-click",e=>{let t=null==m?void 0:m.getOverlayById(e.originalTarget.id);if(t){let i=null==t?void 0:t.getBounds(m.viewport);return i.x-=.1,i.y-=.1,i.width+=.2,i.height+=.2,null==m||m.viewport.fitBounds(i,!1),e.preventDefaultAction=!0}})}},[l]),(0,c.useEffect)(()=>{e&&(null==m||m.clearOverlays(),e.forEach(e=>{var t,i,n,r;let{annotation:a,targetIndex:o}=e,l=(null==(i=null==(t=null==m?void 0:m.viewport)?void 0:t.getBounds())?void 0:i.width)||1,s=null==m?void 0:m.world.getItemAt(o),c=s?(null==s?void 0:s.getBounds().width)/(null==s?void 0:s.getContentSize().x):(null==(n=h[o])?void 0:n.width)/l,d=tN(null==a?void 0:a.target),u=null!=a&&a.body?null==(r=null==a?void 0:a.body[0])?void 0:r.value:void 0;if(null!=d&&d.rect){let{x:e,y:t,w:i,h:n}=null==d?void 0:d.rect,r=function(e,t,i){let n=e*i;if(0===t)return n;for(;t>0;){let e=null==m?void 0:m.world.getItemAt(t-1);if(e)n+=e.getBounds().width,t--;else break}return n}(e,o,c),l=new I.Rect(r,t*c,i*c,n*c),s=document.createElement("button");if(s.classList.add("clover-iiif-image-openseadragon-annotation"),s.id=a.id,s.setAttribute("tabindex","0"),s.setAttribute("role","button"),s.setAttribute("data-active","true"),s.setAttribute("tabindex","0"),s.setAttribute("role","button"),s.setAttribute("data-active","false"),u){s.setAttribute("aria-label",u);let e=document.createElement("label");e.innerHTML=u,s.appendChild(e)}s.addEventListener("mousedown",e=>{e.stopPropagation(),e.preventDefault()}),s.addEventListener("touchstart",e=>{e.stopPropagation(),e.preventDefault()}),s.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault()}),s.addEventListener("keydown",e=>{if("Enter"===e.key){e.stopPropagation(),e.preventDefault();let t=new I.Rect(l.x-.1,l.y-.1,l.width+.2,l.height+.2);null==m||m.viewport.fitBounds(t,!1)}}),s.addEventListener("focus",()=>{s.setAttribute("data-active","true")}),s.addEventListener("mouseover",()=>{s.setAttribute("data-active","true")}),s.addEventListener("mouseout",()=>{s.removeAttribute("data-active")}),s.addEventListener("blur",()=>{s.removeAttribute("data-active")}),null==m||m.addOverlay(s,l,I.Placement.CENTER)}}),b())},[l,e]),c.createElement(rK,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":i.id,hasNavigator:i.showNavigator},c.createElement(r8,{_cloverViewerHasPlaceholder:r,config:i}),i.showNavigator&&c.createElement(rX,{id:i.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),c.createElement(rY,{id:i.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...t&&{"aria-label":t}}))},ai=({_cloverViewerHasPlaceholder:e=!1,annotations:t,body:i,instanceId:n,isTiledImage:r=!1,label:a,src:o="",openSeadragonCallback:l,openSeadragonConfig:s={}})=>{let d=n??(0,m.A)(),u="string"==typeof a?a:tU(a),p={...function(e){return{id:`openseadragon-${e}`,navigatorId:`openseadragon-navigator-${e}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${e}`,homeButton:`reset-${e}`,rotateLeftButton:`rotateLeft-${e}`,rotateRightButton:`rotateRight-${e}`,zoomInButton:`zoomIn-${e}`,zoomOutButton:`zoomOut-${e}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}(d),...s},h=Array.isArray(i)?i:i?[i]:[],f=Array.isArray(o)?o:o?[o]:[],v=[],y=rG.SimpleImage;if(h.length){let e=h.map(rJ);v=e.map(e=>e.uri).filter(Boolean),y=e.some(e=>e.imageType===rG.TiledImage)?rG.TiledImage:rG.SimpleImage}else if(f.length){let e=f.map(e=>rZ(e,r));v=e.map(e=>e.uri).filter(Boolean),y=e.some(e=>e.imageType===rG.TiledImage)?rG.TiledImage:rG.SimpleImage}return v.length?c.createElement(g.ErrorBoundary,{FallbackComponent:th},c.createElement(at,{_cloverViewerHasPlaceholder:e,annotations:t,ariaLabel:u,config:p,imageType:y,key:d,uri:v,openSeadragonCallback:e=>{null==l||l(e)}})):null},an=({isActive:e,isMedia:t,items:i,setIsInteractive:n})=>{let{vault:r}=e9(),[a,o]=(0,c.useState)([]),l=a.length>1;if((0,c.useEffect)(()=>{o([]);let e=i.map(e=>{let t=ta(r,e.id);if(!t)return null;let{id:i,width:n,height:a}=t[0];return i?{src:i,width:n||640,height:a||640,alt:e.label?tr(e.label):"placeholder image"}:null}).filter(e=>null!==e);e.length&&o(e)},[i,l]),!e||!a.length)return null;let s=a.map(e=>e.width/e.height*1),d=s.reduce((e,t)=>e+t,0);return c.createElement(rt,{onClick:()=>n(!0),isMedia:t,className:"clover-viewer-placeholder","data-active":e,"data-paged":l},a.map((e,t)=>{let i=s[t]/d*100;return c.createElement("img",{...e,key:t,alt:e.alt,style:{width:`${i}%`}})}))},ar=tl("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),aa=c.forwardRef((e,t)=>{let i=c.useRef(null),n=(0,c.useCallback)(()=>{var e,n;if(null!=(e=t.current)&&e.currentTime&&(null==(n=t.current)?void 0:n.currentTime)>0)return;let r=t.current;if(!r)return;let a=new AudioContext,o=a.createMediaElementSource(r),l=a.createAnalyser(),s=i.current;if(!s)return;s.width=r.offsetWidth,s.height=r.offsetHeight;let c=s.getContext("2d");o.connect(l),l.connect(a.destination),l.fftSize=256;let d=l.frequencyBinCount,u=new Uint8Array(d);setInterval(function(){!function(e,t,i,n,r,a){let o=r/i*2.6,l,s=0;e.getByteFrequencyData(n),t.fillStyle="#000000",t.fillRect(0,0,r,a);for(let e=0;e<i;e++)l=2*n[e],t.fillStyle="rgba(78, 42, 132, 1)",t.fillRect(s,a-l,o,l),s+=o+6}(l,c,d,u,s.width,s.height)},20)},[t]);return c.useEffect(()=>{t&&t.current&&(t.current.onplay=n)},[n,t]),c.createElement(ar,{ref:i,role:"presentation"})}),ao=tl("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),al=({resource:e,ignoreCaptionLabels:t})=>{let i=tr(e.label,"en");return Array.isArray(i)&&i.some(e=>t.includes(e))?null:c.createElement("track",{key:e.id,src:e.id,label:Array.isArray(i)?i[0]:i,srcLang:"en","data-testid":"player-track"})},as=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],ac=({allSources:e,annotationResources:t,painting:i})=>{let[n,r]=c.useState(0),[a,o]=c.useState(),l=c.useRef(null),s=(null==i?void 0:i.type)==="Sound",d=te(),{activeCanvas:u,configOptions:m,contentStateAnnotation:p,vault:h}=e9();return(0,c.useEffect)(()=>{if(!i.id||!l.current)return;if(null!=l&&l.current){let e=l.current;d({type:"updateActivePlayer",player:e}),e.src=i.id,e.load()}if("m3u8"!==i.id.split(".").pop()&&i.format&&!as.includes(i.format))return;let e=new S.Ay({xhrSetup:function(e,t){e.withCredentials=!!m.withCredentials}});return e.attachMedia(l.current),e.on(S.Ay.Events.MEDIA_ATTACHED,function(){e.loadSource(i.id)}),e.on(S.Ay.Events.ERROR,function(t,i){if(i.fatal)switch(i.type){case S.Ay.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${t} network error encountered, try to recover`),e.startLoad();break;case S.Ay.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${t} media error encountered, try to recover`),e.recoverMediaError();break;default:e.destroy()}}),()=>{if(e&&l.current){let t=l.current;e.detachMedia(),e.destroy(),t.currentTime=0}}},[m.withCredentials,i.id,i.format,d]),(0,c.useEffect)(()=>{var e,t,i,r;let a=h.get(u),l=null!=(e=a.accompanyingCanvas)&&e.id?ta(h,null==(t=a.accompanyingCanvas)?void 0:t.id):null,s=null!=(i=a.placeholderCanvas)&&i.id?ta(h,null==(r=a.placeholderCanvas)?void 0:r.id):null;l&&s?o(0===n?s[0].id:l[0].id):(l&&o(l[0].id),s&&o(s[0].id))},[u,n,h]),(0,c.useEffect)(()=>{let e=null==l?void 0:l.current;if(!e)return;let t=null,i=!1,n=()=>{i||(i=!0,t=setInterval(()=>{!e||e.paused||e.ended||(r(e.currentTime),d({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(e.currentTime)}}))},500)),e&&e.paused&&(r(e.currentTime),d({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(e.currentTime)}}))};return e.addEventListener("timeupdate",n),()=>{null==e||e.removeEventListener("timeupdate",n),t&&clearInterval(t)}},[i.id,u]),(0,c.useEffect)(()=>{var e,t;if(p){let i=null==l?void 0:l.current;if(!i)return;let{type:n,t:a,value:o}=(null==(e=null==p?void 0:p.target)?void 0:e.selector)||{};if(((null==(t=null==p?void 0:p.target)?void 0:t.source)||(null==p?void 0:p.target)).id!==u)return;if(a&&"PointSelector"===n&&(r(a),i.currentTime=a),"FragmentSelector"===n&&o){let e=o.split("=")[1];if(!e)return;let t=e.split(",")[0];r(t),i.currentTime=t}}},[l,p]),c.createElement(ao,{css:{backgroundColor:m.canvasBackgroundColor,maxHeight:m.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},c.createElement("video",{id:"clover-iiif-video",key:i.id,ref:l,"data-src":i.id,controls:!0,height:i.height,width:i.width,crossOrigin:m.crossOrigin,poster:a,style:{maxHeight:m.canvasHeight,position:"relative",zIndex:"1"}},e.map(e=>c.createElement("source",{src:e.id,type:e.format,key:e.id})),(null==t?void 0:t.length)>0&&t.map(e=>{let t=[];return e.items.forEach(e=>{h.get(e.id).body.forEach(e=>{let i=h.get(e.id);t.push(i)})}),t.map(e=>c.createElement(al,{resource:e,ignoreCaptionLabels:m.ignoreCaptionLabels||[],key:e.id}))}),"Sorry, your browser doesn't support embedded videos."),s&&c.createElement(aa,{ref:l}))},ad=()=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},c.createElement("title",{id:"close-svg-title"},"close"),c.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),au=({isMedia:e})=>c.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},c.createElement("title",{id:"open-svg-title"},"open"),e?c.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):c.createElement(c.Fragment,null,c.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),c.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),am=({handleToggle:e,isInteractive:t,isMedia:i})=>c.createElement(rn,{onClick:e,isInteractive:t,isMedia:i,"data-testid":"placeholder-toggle"},t?c.createElement(ad,null):c.createElement(au,{isMedia:i})),ap=({activeCanvas:e,annotationResources:t,contentSearchResource:i,isMedia:n,painting:r})=>{var a,o,l,s;let[d,u]=c.useState(0),[m,p]=c.useState(!1),[h,f]=c.useState([]),[g,v]=c.useState([]),[y,b]=c.useState(0),{configOptions:x,customDisplays:w,contentStateAnnotation:E,informationPanelResource:S,openSeadragonViewer:C,vault:A,viewerId:k,visibleCanvases:I}=e9(),[R,T]=c.useState([]),O=!!E&&e===(null==(o=null==(a=null==E?void 0:E.target)?void 0:a.source)?void 0:o.id),$=te(),L=A.get(e),M=g.length&&!m&&!n,P=(null==r?void 0:r.length)>1,F=`${k}-${eX(e+d+JSON.stringify(I)+y)}`,j=()=>{p(!m),b(e=>e+1)},z=w.find(t=>{var i;let n=!1,{canvasId:a,paintingFormat:o}=t.target;if(Array.isArray(a)&&a.length>0&&(n=a.includes(e)),Array.isArray(o)&&o.length>0){let e=(null==(i=r[d])?void 0:i.format)||"";n=!!(e&&o.includes(e))}return n});(0,c.useEffect)(()=>{O&&M&&0===y&&j()},[O,M]),(0,c.useEffect)(()=>{M&&($({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),$({type:"updateActiveSelector",selector:void 0}))},[M]),(0,c.useEffect)(()=>{var e,n,r;let a=[];if("manifest-annotations"===S&&(null==t||t.forEach((e,t)=>{var i;null==(i=null==e?void 0:e.items)||i.forEach(e=>{let i=A.get(e.id);i&&a.push({annotation:{...i,body:i.body.map(e=>A.get(e.id)||e)},targetIndex:t})})}),E)){let t=(null==(e=null==E?void 0:E.target)?void 0:e.source)||(null==E?void 0:E.target);a.push({annotation:{...E,body:null==(n=null==E?void 0:E.body)?void 0:n.map(e=>A.get(e.id)||e)},targetIndex:I.findIndex(e=>e.id===t.id)})}"manifest-content-search"===S&&(null==(r=null==i?void 0:i.items)||r.forEach(e=>{let t=A.get(e.id);if(t){let e=I.findIndex(e=>e.id===t.target.source.id);"number"==typeof e&&a.push({annotation:{...t,body:t.body.map(e=>A.get(e.id)||e)},targetIndex:e})}})),T(a)},[t,i,E,S,I]),(0,c.useEffect)(()=>{if(!n){let e=I.map(e=>{let t=ta(A,e.id);return t?t[d]:void 0}).filter(Boolean),t=I.map(e=>{var t;let i=e.id,n=A.get(i),r=null==(t=null==n?void 0:n.placeholderCanvas)?void 0:t.id;return r&&r?{id:r,label:null==n?void 0:n.label}:null}).filter(e=>null!==e);f(e),v(t)}},[d,e,I,n,L]),(0,c.useEffect)(()=>{u(0)},[I]);let _=null==(l=null==z?void 0:z.display)?void 0:l.component;return c.createElement(rr,{className:"clover-viewer-painting"},c.createElement(ra,{style:{backgroundColor:x.canvasBackgroundColor,height:"auto"===x.canvasHeight?"100%":x.canvasHeight}},!!g.length&&!n&&c.createElement(am,{handleToggle:j,isInteractive:m,isMedia:n}),!!(null!=g&&g.length)&&!n&&c.createElement(an,{isActive:!!M,isMedia:n,items:g,setIsInteractive:p}),!M&&!z&&(n?c.createElement(ac,{allSources:r,painting:r[d],annotationResources:t}):r&&c.createElement(ai,{_cloverViewerHasPlaceholder:!!(null!=g&&g.length),annotations:R,body:h,instanceId:F,key:F,openSeadragonCallback:e=>{e&&!M&&(null==C?void 0:C.id)!==`openseadragon-${F}`&&$({type:"updateOpenSeadragonViewer",openSeadragonViewer:e})},openSeadragonConfig:x.openSeadragon})),!M&&_&&c.createElement(_,{id:e,annotationBody:r[d],hooks:{useViewerDispatch:te,useViewerState:e9},...null==z?void 0:z.display.componentProps})),P&&c.createElement(rp,{value:null==(s=r[d])?void 0:s.id,onValueChange:e=>{u(r.findIndex(t=>t.id===e))},maxHeight:"200px"},null==r?void 0:r.map(e=>c.createElement(rh,{value:null==e?void 0:e.id,key:null==e?void 0:e.id,label:null==e?void 0:e.label}))))},ah=({activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:r,isAudioVideo:a,items:o,painting:l})=>{var s,d;let{contentStateAnnotation:u,isInformationOpen:m,configOptions:p,sequence:h,visibleCanvases:f}=e9(),{informationPanel:g}=p,v=f.map(e=>e.id),y=(t.length>0||v.includes(null==(d=null==(s=null==u?void 0:u.target)?void 0:s.source)?void 0:d.id))&&(null==g?void 0:g.renderAnnotation)&&(null==g?void 0:g.renderToggle)===!1&&m,b=(null==g?void 0:g.renderAbout)&&m||y,x=null==g?void 0:g.renderToggle;return c.createElement(tg,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},c.createElement(tv,{"data-aside-active":b,"data-aside-toggle":x},c.createElement(ap,{activeCanvas:e,annotationResources:t,contentSearchResource:r,isMedia:a,painting:l}),h[1].length>1&&c.createElement(tf,{className:"clover-viewer-media-wrapper"},c.createElement(re,{items:o,activeItem:0}))),b&&c.createElement(ty,{"data-aside-active":b,"data-aside-toggle":x},c.createElement(iF,{activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:r})))},af=tl(iq.Trigger,{width:"30px",padding:"5px"}),ag=tl(iq.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),av=tl("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),ay=tl("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${ru}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),ab=tl("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),ax=()=>{var e;let t=te(),{activeManifest:i,collection:n,configOptions:r,vault:a}=e9(),o=null==r?void 0:r.canvasHeight;return c.createElement("div",{style:{margin:"0.75rem"}},c.createElement(rp,{label:n.label,maxHeight:o,value:i,onValueChange:e=>{t({type:"updateActiveCanvas",canvasId:void 0}),t({type:"updateActiveManifest",manifestId:e}),t({type:"updateViewerId",viewerId:(0,m.A)()})}},null==(e=null==n?void 0:n.items)?void 0:e.map(e=>c.createElement(rh,{value:e.id,key:e.id,thumbnail:null!=e&&e.thumbnail?a.get(null==e?void 0:e.thumbnail):void 0,label:e.label}))))},aw=(e,t=2500)=>{let{t:i}=(0,s.Bd)(),[n,r]=(0,c.useState)(""),a=(0,c.useCallback)(()=>{navigator.clipboard.writeText(e).then(()=>r(i("copySuccess")),()=>r(i("copyFailure")))},[e]);return(0,c.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>r(""),t);return()=>clearTimeout(e)},[n]),[n,a]},aE=tl("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),aS=({status:e})=>e?c.createElement(aE,{"data-copy-status":e},e):null,aC=({textPrompt:e,textToCopy:t})=>{let[i,n]=aw(t);return c.createElement("button",{onClick:n},e," ",c.createElement(aS,{status:i}))},aA=({title:e})=>{let t="#ed1d33",i="#2873ab";return c.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},c.createElement("title",null,e),c.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},c.createElement("g",{transform:"scale(0.1)"},c.createElement("path",{style:{fill:i},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),c.createElement("path",{style:{fill:i},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),c.createElement("path",{style:{fill:t},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),c.createElement("path",{style:{fill:t},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),c.createElement("path",{style:{fill:i},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),c.createElement("path",{style:{fill:i},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),c.createElement("path",{style:{fill:t},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},ak=tl(R.bL,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),aI=tl(R.zi,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});tl("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});let aR=tl("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),aT=c.memo(()=>{let{isInformationOpen:e}=e9(),t=te(),{t:i}=(0,s.Bd)();return c.createElement(aR,null,c.createElement(ak,{checked:e,onCheckedChange:e=>{t({type:"updateInformationOpen",isInformationOpen:e})},id:"information-toggle","aria-label":i("informationPanelToggle"),name:"toggled?"},c.createElement(aI,null,c.createElement("span",null,"i"))))}),aO=tl(iq.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),a$=tl(ag,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function aL(e,t){let i=[];if(!e)return i;for(let n of e)if(n.id){let e=t.get(n.id);e&&i.push(e)}return i}function aM(e,t){return e.map(({format:e,id:i,label:n})=>({format:e,id:function(e){let{vault:t}=e9();try{let i=e&&t.get(e);if(!i)throw Error(`Vault entity ${e} not found.`);return(null==i?void 0:i["@id"])||(null==i?void 0:i.id)}catch(t){return console.error(t),e}}(i),label:tU(n)||t}))}let aP=()=>{let{allPages:e,individualPages:t}=function(){let e=function(){let{activeCanvas:e,activeManifest:t,vault:i}=e9(),[n,r]=(0,c.useState)({root:[],canvas:[]});return(0,c.useEffect)(()=>{let n=i.get(t),a=i.get(e),o=null==n?void 0:n.rendering,l=null==a?void 0:a.rendering;r({root:aL(o,i),canvas:aL(l,i)})},[e,t,i]),{...n}}();return{allPages:aM((null==e?void 0:e.root)||[],"Root Rendering Label"),individualPages:aM((null==e?void 0:e.canvas)||[],"Canvas Rendering Label")}}(),i=e.length>0||t.length>0,n=e=>{window.open(e,"_blank")};return i?c.createElement(iq,null,c.createElement(aO,{"data-testid":"download-button"},c.createElement(iz,null,c.createElement(iz.Download,null))),c.createElement(a$,{"data-testid":"download-content"},t.length>0&&c.createElement(c.Fragment,null,c.createElement("h3",null,"Individual Pages"),c.createElement("ul",null,t.map(({format:e,id:t,label:i})=>c.createElement("li",{key:i},c.createElement("button",{onClick:()=>n(t)},i," (",e,")"))))),e.length>0&&c.createElement(c.Fragment,null,c.createElement("h3",null,"All Pages"),c.createElement("ul",null,e.map(({format:e,id:t,label:i})=>c.createElement("li",{key:i},c.createElement("button",{onClick:()=>n(t)},i," (",e,")"))))))):null},aF=({manifestId:e,manifestLabel:t})=>{let{collection:i,configOptions:n}=e9(),{informationPanel:r,showDownload:a,showIIIFBadge:o,showTitle:l}=n,d=a||o||(null==r?void 0:r.renderToggle),{t:u}=(0,s.Bd)();return c.createElement(ay,{className:"clover-viewer-header"},null!=i&&i.items?c.createElement(ax,null):c.createElement(av,{className:l?"":"visually-hidden"},l&&c.createElement(tJ,{label:t,className:"label"})),d&&c.createElement(ab,null,a&&c.createElement(aP,null),o&&c.createElement(iq,null,c.createElement(af,null,c.createElement(aA,{title:u("commonShare")})),c.createElement(ag,null,(null==i?void 0:i.items)&&c.createElement("button",{onClick:e=>{e.preventDefault(),window.open(i.id,"_blank")}},u("shareCollectionJson")),c.createElement("button",{onClick:t=>{t.preventDefault(),window.open(e,"_blank")}},u("shareManifestJson"))," ",(null==i?void 0:i.items)&&c.createElement(aC,{textPrompt:u("shareCollectionCopy"),textToCopy:i.id}),c.createElement(aC,{textPrompt:u("shareManifestCopy"),textToCopy:e}))),(null==r?void 0:r.renderToggle)&&c.createElement(aT,null)))},aj=e=>{let t=()=>!!window.matchMedia&&window.matchMedia(e).matches,[i,n]=(0,c.useState)(t);return(0,c.useEffect)(()=>{let e=()=>n(t);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),i},az=({manifest:e,theme:t,iiifContentSearchQuery:i})=>{var n;let r=e9(),a=te(),{activeCanvas:o,isInformationOpen:l,vault:s,configOptions:d,visibleCanvases:u}=r,m=(null==d?void 0:d.canvasHeight)&&["100%","auto"].includes(null==d?void 0:d.canvasHeight),[p,v]=(0,c.useState)(!1),[y,b]=(0,c.useState)([]),[x,w]=(0,c.useState)([]),[E,S]=(0,c.useState)(),C=aj(to.sm),[A,k]=(0,c.useState)(),I=(0,c.useCallback)(e=>{a({type:"updateInformationOpen",isInformationOpen:e})},[a]);(0,c.useEffect)(()=>{var e;null!=(e=null==d?void 0:d.informationPanel)&&e.open&&I(!C)},[C,null==(n=null==d?void 0:d.informationPanel)?void 0:n.open]),(0,c.useEffect)(()=>{},[C]),(0,c.useEffect)(()=>{let t=ta(s,o);t&&(v(["Sound","Video"].indexOf(t[0].type)>-1),b(t)),a({type:"updateVisibleCanvases",visibleCanvases:(0,h.iT)(s,e,o)})},[o,C,e,s,a]),(0,c.useEffect)(()=>{(async()=>{w((await Promise.all(u.map(e=>tt(s,e.id)))).flat())})()},[u]);let R=e.service.some(e=>["SearchService1","SearchService2"].includes(e.type||e["@type"]));return(0,c.useEffect)(()=>{if(R){let t=e.service.find(e=>["SearchService1","SearchService2"].includes(e.type||e["@type"]));t&&k(t.id||t["@id"])}},[e,R]),(0,c.useEffect)(()=>{var e;A&&(null==(e=d.informationPanel)?void 0:e.renderContentSearch)!==!1&&ti(s,A,i).then(e=>S(e))},[A]),c.createElement(g.ErrorBoundary,{FallbackComponent:th},c.createElement(tb,{className:`${t} clover-viewer`,css:{background:null==d?void 0:d.background},"data-absolute-position":m,"data-information-panel-open":l},c.createElement(f.bL,{open:l,onOpenChange:I},c.createElement(aF,{manifestLabel:e.label,manifestId:e.id}),c.createElement(ah,{activeCanvas:o,painting:y,annotationResources:x,searchServiceUrl:A,setContentSearchResource:S,contentSearchResource:E,items:e.items,isAudioVideo:p}))))},a_={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function aH(e,t=null){return{ok:!1,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:t||e.statusText,json:()=>JSON.parse(t||e.statusText)}}let aB={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},aD=({canvasIdCallback:e,contentStateCallback:t,customDisplays:i=[],plugins:n=[],customTheme:r,iiifContent:a,id:o,manifestId:l,options:s,iiifContentSearchQuery:d})=>{var u,m,p;let h=a;o&&(h=o),l&&(h=l);let f=e2(null==(m=null==(u=null==s?void 0:s.informationPanel)?void 0:u.vtt)?void 0:m.autoScroll);return c.createElement(e7,{initialState:{...e4,customDisplays:i,plugins:n,isAutoScrollEnabled:f.enabled,isInformationOpen:!!(null!=(p=null==s?void 0:s.informationPanel)&&p.open),vault:new eQ({customFetcher:e=>(function(e,t=a_){let i=t.headers||a_.headers;return new Promise((n,r)=>{let a=new XMLHttpRequest;a.open("get",e),a.withCredentials=t.withCredentials,i&&Object.keys(i).forEach(e=>a.setRequestHeader(e,i[e])),a.onload=()=>{n({ok:a.status>=200&&a.status<300,status:a.status,statusText:a.statusText,headers:a.getAllResponseHeaders(),data:a.responseText,json:()=>JSON.parse(a.responseText)})},a.onerror=()=>{r(aH(a,"Failed to make request."))},a.ontimeout=()=>{r(aH(a,"Request took longer than expected."))},a.send()})})(e,{withCredentials:null==s?void 0:s.withCredentials,headers:null==s?void 0:s.requestHeaders}).then(e=>JSON.parse(e.data))})}},c.createElement(aV,{iiifContent:h,canvasIdCallback:e,contentStateCallback:t,customTheme:r,options:s,iiifContentSearchQuery:d}))},aV=({canvasIdCallback:e,contentStateCallback:t,customTheme:i,iiifContent:n,options:r,iiifContentSearchQuery:a})=>{let o=te(),{activeCanvas:l,activeManifest:s,activeSelector:d,isLoaded:u,vault:m,visibleCanvases:f}=e9(),[g,y]=(0,c.useState)(),[b,x]=(0,c.useState)(),w={};if(i&&(w=(0,v.an)("custom",i)),(0,c.useEffect)(()=>{o({type:"updateActiveSelector",selector:void 0})},[l,s]),(0,c.useEffect)(()=>{var i;if(e&&e(l),t&&s&&l){let e=(null==(i=f[0])?void 0:i.id)||l,n=`${s}/state/${eX(e+JSON.stringify(d))}`,r={...aB,id:n,target:{type:"SpecificResource",source:{id:e,type:"Canvas",partOf:[{id:s,type:"Manifest"}]},selector:d}};t({json:r,encoded:(0,p.PP)(JSON.stringify(r))})}},[l,s,d,e,t,f]),(0,c.useEffect)(()=>{s&&m.load(s).then(e=>{if(!e)return;x(e);let t=(0,h.X)(m,e);o({type:"updateActiveCanvas",canvasId:l||rq(e)}),o({type:"updateManifestSequence",sequence:t})}).catch(e=>{console.error(`Manifest failed to load: ${e}`)}).finally(()=>{o({type:"updateIsLoaded",isLoaded:!0})})},[n,s,o,m]),(0,c.useEffect)(()=>{o({type:"updateConfigOptions",configOptions:r}),(async()=>{var e;if(!n)return;let t=rW(n);try{let e="object"==typeof t&&null!=t&&t.id?await m.loadSync(null==t?void 0:t.id,t):await m.load(t);y(e)}catch(i){if(t&&t.id||console.error(`Failed to load resource: ${i}`),null!=t&&t.id&&(null==t?void 0:t.type)==="Annotation"&&null!=(e=null==t?void 0:t.motivation)&&e.includes("contentState")){let e=await m.loadSync(t.id,t);e&&y(e)}else null!=t&&t.id&&["Canvas","Manifest"].includes(null==t?void 0:t.type)&&await m.loadSync(t.id,t)&&y({...aB,target:t})}})()},[o,n,r,m]),(0,c.useEffect)(()=>{if(g)switch(g.type){case"Annotation":if(null!=g&&g.motivation&&(Array.isArray(null==g?void 0:g.motivation)?null!=g&&g.motivation.includes("contentState"):(null==g?void 0:g.motivation)==="content-state")){let{active:e}=rD(g);o({type:"updateActiveManifest",manifestId:e.manifest}),o({type:"updateActiveCanvas",canvasId:e.canvas}),o({type:"updateContentStateAnnotation",contentStateAnnotation:g})}break;case"Collection":let e=rU(g);o({type:"updateCollection",collection:g}),e&&o({type:"updateActiveManifest",manifestId:e});break;case"Manifest":o({type:"updateActiveManifest",manifestId:g.id})}},[o,n,g]),!u)if(null==r||!r.customLoadingComponent)return c.createElement(c.Fragment,null,"Loading");else{let e=r.customLoadingComponent;return c.createElement(e,null)}return b&&b.items?0===b.items.length?(console.log(`The IIIF manifest ${n} does not contain canvases.`),c.createElement(c.Fragment,null)):c.createElement(az,{manifest:b,theme:w,key:b.id,iiifContentSearchQuery:a}):(console.log(`The IIIF manifest ${n} failed to load.`),c.createElement(c.Fragment,null))}}}]);